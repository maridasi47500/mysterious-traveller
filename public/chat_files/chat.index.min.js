/*function CheckActivation(){var e=0;if(genericGET("activationremindercount/".concat(encodeURI(chatterId)),{}).done(function(t){e=t}).fail(function(e){}),0!=e)switch(e){case-4:case 1:case 2:case 3:window.feedBack.showMailNotValidFeedBack()}}function ChangeMailByButton(){var e=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;$('[id^="error-message"]').removeClass("shown"),$(".swal2-input").each(function(){""!=$(this).val()&&(e.test($(this).val())?UpdateMail($(this).val()):($(this)[0].classList.add("error"),$(this).focus()))})}function ChangeMail(e,t){if(t=t||window.event,$('[id^="error-message"]').removeClass("shown"),e.classList.remove("error"),13==t.keyCode){var n=e.value,i=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return i.test(n)?UpdateMail(n):(e.classList.add("error"),e.focus()),!1}return!0}function UpdateMail(e){genericPOST("updatemail/".concat(encodeURI(chatterId)),{email:e}).done(function(e){var t=new window.system.Message(window.getFeedbackMessageResource("emailUpdated")+" "+window.getFeedbackMessageResource("activationMailSent"),system.MessageType.Info);window.feedBack.showSweetAlert(t,null)}).fail(function(e){$('[id^="error-message"]').addClass("shown")})}function SendActivationMail(){genericPOST("sendactivationmail/".concat(encodeURI(chatterId)),{}).done(function(e){}).fail(function(e){});var e=new window.system.Message(window.getFeedbackMessageResource("activationMailSent"),system.MessageType.Info);window.feedBack.showSweetAlert(e,purgeAndLogout)}function purgeAndLogout(){return genericPATCH("vips/".concat(encodeURI(chatterId),"/purgeandlogout"))}function genericGET(e,t){var n=navigator.appVersion.indexOf("Trident")>-1||navigator.appVersion.indexOf("MSIE")>-1||navigator.appVersion.indexOf("Edge")>1;return n?$.ajax({headers:{"User-Descriptor":httpHeaderFormatter.format(userDescriptor)},accepts:{json:"application/json"},url:baseUrl.concat(e),data:t,contentType:"application/json",type:"GET",async:!1,cache:!1}):$.ajax({headers:{"User-Descriptor":httpHeaderFormatter.format(userDescriptor)},accepts:{json:"application/json"},url:baseUrl.concat(e),data:t,contentType:"application/json",type:"GET",async:!1})}function genericPOST(e,t){return $.ajax({headers:{"User-Descriptor":httpHeaderFormatter.format(userDescriptor)},accepts:{json:"application/json"},url:baseUrl.concat(e),data:t!=={}?JSON.stringify(t):t,contentType:"application/json",type:"POST"})}function genericPATCH(e,t){return $.ajax({headers:{"User-Descriptor":httpHeaderFormatter.format(userDescriptor)},accepts:{json:"application/json"},url:baseUrl.concat(e),data:t!=={}?JSON.stringify(t):t,contentType:"application/json",type:"PATCH"})}(function(){var e=!0,t=null,n=!1;(function(){var i,o={}.hasOwnProperty,s=[].slice;((i=this.google)!=t?i.maps:void 0)!=t&&(this.OverlappingMarkerSpiderfier=function(){function i(e,n){var i,s,a,c,d=this;this.map=e,n==t&&(n={});for(i in n)o.call(n,i)&&(s=n[i],this[i]=s);for(this.e=new this.constructor.g(this.map),this.n(),this.b={},c=["click","zoom_changed","maptypeid_changed"],s=0,a=c.length;s<a;s++)i=c[s],r.addListener(this.map,i,function(){return d.unspiderfy()})}var r,a,c,d,u,l,p,h;for(l=i.prototype,h=[i,l],d=0,u=h.length;d<u;d++)c=h[d],c.VERSION="0.3.3";return a=google.maps,r=a.event,u=a.MapTypeId,p=2*Math.PI,l.keepSpiderfied=n,l.markersWontHide=n,l.markersWontMove=n,l.nearbyDistance=20,l.circleSpiralSwitchover=9,l.circleFootSeparation=23,l.circleStartAngle=p/12,l.spiralFootSeparation=26,l.spiralLengthStart=11,l.spiralLengthFactor=4,l.spiderfiedZIndex=1e3,l.usualLegZIndex=10,l.highlightedLegZIndex=20,l.legWeight=1.5,l.legColors={usual:{},highlighted:{}},d=l.legColors.usual,c=l.legColors.highlighted,d[u.HYBRID]=d[u.SATELLITE]="#fff",c[u.HYBRID]=c[u.SATELLITE]="#f00",d[u.TERRAIN]=d[u.ROADMAP]="#444",c[u.TERRAIN]=c[u.ROADMAP]="#f00",l.n=function(){this.a=[],this.j=[]},l.addMarker=function(i){var o,s=this;return i._oms!=t?this:(i._oms=e,o=[r.addListener(i,"click",function(e){return s.F(i,e)})],this.markersWontHide||o.push(r.addListener(i,"visible_changed",function(){return s.o(i,n)})),this.markersWontMove||o.push(r.addListener(i,"position_changed",function(){return s.o(i,e)})),this.j.push(o),this.a.push(i),this)},l.o=function(e,n){if(e._omsData!=t&&(n||!e.getVisible())&&this.s==t&&this.t==t)return this.unspiderfy(n?e:t)},l.getMarkers=function(){return this.a.slice(0)},l.removeMarker=function(e){var n,i,o,s,a;if(e._omsData!=t&&this.unspiderfy(),n=this.m(this.a,e),0>n)return this;for(o=this.j.splice(n,1)[0],s=0,a=o.length;s<a;s++)i=o[s],r.removeListener(i);return delete e._oms,this.a.splice(n,1),this},l.clearMarkers=function(){var e,t,n,i,o,s,a,c;for(this.unspiderfy(),c=this.a,e=i=0,s=c.length;i<s;e=++i){for(n=c[e],t=this.j[e],o=0,a=t.length;o<a;o++)e=t[o],r.removeListener(e);delete n._oms}return this.n(),this},l.addListener=function(e,n){var i,o;return((o=(i=this.b)[e])!=t?o:i[e]=[]).push(n),this},l.removeListener=function(e,t){var n;return n=this.m(this.b[e],t),0>n||this.b[e].splice(n,1),this},l.clearListeners=function(e){return this.b[e]=[],this},l.trigger=function(){var e,n,i,o,r,a;for(n=arguments[0],e=2<=arguments.length?s.call(arguments,1):[],n=(i=this.b[n])!=t?i:[],a=[],o=0,r=n.length;o<r;o++)i=n[o],a.push(i.apply(t,e));return a},l.u=function(e,t){var n,i,o,s,r;for(o=this.circleFootSeparation*(2+e)/p,i=p/e,r=[],n=s=0;0<=e?s<e:s>e;n=0<=e?++s:--s)n=this.circleStartAngle+n*i,r.push(new a.Point(t.x+o*Math.cos(n),t.y+o*Math.sin(n)));return r},l.v=function(e,t){var n,i,o,s,r;for(o=this.spiralLengthStart,n=0,r=[],i=s=0;0<=e?s<e:s>e;i=0<=e?++s:--s)n+=this.spiralFootSeparation/o+5e-4*i,i=new a.Point(t.x+o*Math.cos(n),t.y+o*Math.sin(n)),o+=p*this.spiralLengthFactor/n,r.push(i);return r},l.F=function(e,n){var i,o,s,r,a,c,d,u,l;if(r=e._omsData!=t,(!r||!this.keepSpiderfied)&&this.unspiderfy(),r||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",e,n);for(r=[],a=[],i=this.nearbyDistance,c=i*i,s=this.c(e.position),l=this.a,d=0,u=l.length;d<u;d++)i=l[d],i.map!=t&&i.getVisible()&&(o=this.c(i.position),this.f(o,s)<c?r.push({A:i,p:o}):a.push(i));return 1===r.length?this.trigger("click",e,n):this.G(r,a)},l.markersNearMarker=function(e,i){var o,s,r,a,c,d,u,l,p,h;if(i==t&&(i=n),this.e.getProjection()==t)throw"Must wait for 'idle' event on map before calling markersNearMarker";for(o=this.nearbyDistance,c=o*o,r=this.c(e.position),a=[],l=this.a,d=0,u=l.length;d<u&&(o=l[d],o===e||o.map==t||!o.getVisible()||(s=this.c((p=(h=o._omsData)!=t?h.l:void 0)!=t?p:o.position),!(this.f(s,r)<c&&(a.push(o),i))));d++);return a},l.markersNearAnyOtherMarker=function(){var i,o,s,r,a,c,d,u,l,p,h,f;if(this.e.getProjection()==t)throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";for(c=this.nearbyDistance,i=c*c,r=this.a,c=[],h=0,s=r.length;h<s;h++)o=r[h],c.push({q:this.c((d=(l=o._omsData)!=t?l.l:void 0)!=t?d:o.position),d:n});for(h=this.a,o=d=0,l=h.length;d<l;o=++d)if(s=h[o],s.map!=t&&s.getVisible()&&(r=c[o],!r.d))for(f=this.a,s=u=0,p=f.length;u<p;s=++u)if(a=f[s],s!==o&&a.map!=t&&a.getVisible()&&(a=c[s],(!(s<o)||a.d)&&this.f(r.q,a.q)<i)){r.d=a.d=e;break}for(h=this.a,s=[],i=d=0,l=h.length;d<l;i=++d)o=h[i],c[i].d&&s.push(o);return s},l.z=function(e){var t=this;return{h:function(){return e._omsData.i.setOptions({strokeColor:t.legColors.highlighted[t.map.mapTypeId],zIndex:t.highlightedLegZIndex})},k:function(){return e._omsData.i.setOptions({strokeColor:t.legColors.usual[t.map.mapTypeId],zIndex:t.usualLegZIndex})}}},l.G=function(t,n){var i,o,s,c,d,u,l,p,h,f;return this.s=e,f=t.length,i=this.C(function(){var e,n,i;for(i=[],e=0,n=t.length;e<n;e++)p=t[e],i.push(p.p);return i}()),c=f>=this.circleSpiralSwitchover?this.v(f,i).reverse():this.u(f,i),i=function(){var e,n,i,p=this;for(i=[],e=0,n=c.length;e<n;e++)s=c[e],o=this.D(s),h=this.B(t,function(e){return p.f(e.p,s)}),l=h.A,u=new a.Polyline({map:this.map,path:[l.position,o],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),l._omsData={l:l.position,i:u},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(d=this.z(l),l._omsData.w={h:r.addListener(l,"mouseover",d.h),k:r.addListener(l,"mouseout",d.k)}),l.setPosition(o),l.setZIndex(Math.round(this.spiderfiedZIndex+s.y)),i.push(l);return i}.call(this),delete this.s,this.r=e,this.trigger("spiderfy",i,n)},l.unspiderfy=function(n){var i,o,s,a,c,d,u;if(n==t&&(n=t),this.r==t)return this;for(this.t=e,a=[],s=[],u=this.a,c=0,d=u.length;c<d;c++)o=u[c],o._omsData!=t?(o._omsData.i.setMap(t),o!==n&&o.setPosition(o._omsData.l),o.setZIndex(t),i=o._omsData.w,i!=t&&(r.removeListener(i.h),r.removeListener(i.k)),delete o._omsData,a.push(o)):s.push(o);return delete this.t,delete this.r,this.trigger("unspiderfy",a,s),this},l.f=function(e,t){var n,i;return n=e.x-t.x,i=e.y-t.y,n*n+i*i},l.C=function(e){var t,n,i,o,s;for(o=n=i=0,s=e.length;o<s;o++)t=e[o],n+=t.x,i+=t.y;return e=e.length,new a.Point(n/e,i/e)},l.c=function(e){return this.e.getProjection().fromLatLngToDivPixel(e)},l.D=function(e){return this.e.getProjection().fromDivPixelToLatLng(e)},l.B=function(e,n){var i,o,s,r,a,c;for(s=a=0,c=e.length;a<c;s=++a)r=e[s],r=n(r),("undefined"==typeof i||i===t||r<o)&&(o=r,i=s);return e.splice(i,1)[0]},l.m=function(e,n){var i,o,s,r;if(e.indexOf!=t)return e.indexOf(n);for(i=s=0,r=e.length;s<r;i=++s)if(o=e[i],o===n)return i;return-1},i.g=function(e){return this.setMap(e)},i.g.prototype=new a.OverlayView,i.g.prototype.draw=function(){},i}())}).call(this)}).call(this),function(e,t){e.MapService=function(e,n){var i=this;i.event=n,i.container=t.getElementById("map"),i.options={emmid:15574,token:"WYH6LWE3J739Q8OP2WOOZZ51L"},i.map,i.markers=[],i.initializeMapWith=function(e){i.map=wemap.v1.createLivemap(i.container,i.options),i.map.addEventListener("pinpointClick",function(e){i.event.publish("MarkerClicked",e.pinpoint.id)})},i.addChattersToMap=function(e){i.clearMap();var t=i.getBoundsFromChatters(e),n={padding:{top:65}};i.map.fitBounds(t,n),i.addChatters(e),i.map.setPinpoints(i.markers)},i.clearMap=function(){i.markers=[]},i.addChatter=function(e){var t={id:e.id,name:e.name,latitude:e.latitude,longitude:e.longitude,description:e.description,media_url:""!==e.profilePictureUrl?e.profilePictureUrl:i.setIconFrom(e.gender),media_type:"image"};i.markers.push(t)},i.setIconFrom=function(e){var t=window.location.protocol+"//"+window.location.hostname+"/Content/Common/Images/",n=0===e?"AvatarMan.jpg":"AvatarWoman.jpg";return t.concat(n)},i.getApplicationName=function(){var t=e.split("-");return t[1]},i.addChatters=function(e){for(var t=0;t<e.length;t++)i.addChatter(e[t])},i.getDistanceBetween=function(e,t){var n={latitude:e.latitude,longitude:e.longitude},o={latitude:t.latitude,longitude:t.longitude};return i.calculateDistanceBetween(n,o)},i.convertDegToRad=function(e){return e*Math.PI/180},i.calculateDistanceBetween=function(e,t){var n=i.convertDegToRad(e.latitude),o=i.convertDegToRad(t.latitude),s=i.convertDegToRad(e.longitude),r=i.convertDegToRad(t.longitude),a=o-n,c=r-s,d=6371e3,u=n,l=o,p=a,h=c,f=Math.sin(p/2)*Math.sin(p/2)+Math.cos(u)*Math.cos(l)*Math.sin(h/2)*Math.sin(h/2),m=(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),Math.acos(Math.sin(u)*Math.sin(l)+Math.cos(u)*Math.cos(l)*Math.cos(h))*d);return m},i.getBoundsFromChatters=function(e){for(var t=e[0].latitude,n=e[0].latitude,i=e[0].longitude,o=e[0].longitude,s=1;s<e.length;s++){var r=e[s];r.latitude<t&&(t=r.latitude),r.latitude>n&&(n=r.latitude),r.longitude<i&&(i=r.longitude),r.longitude>o&&(o=r.longitude)}return[i,t,o,n]}}}(window.system||(window.system={}),document),function(e){e.MapDataService=function(t,n,i){var o=this;o.base=e.ChatDataService,o.base(t,n,i),o.getChatter=function(e){return o.get("chatters/".concat(encodeURI(e)),{})}},e.MapDataService.prototype=new e.ChatDataService}(window.system||(window.system={})),function(e,t,n){t.components.register("map",{viewModel:{createViewModel:function(t){var n=new e.HttpHeaderFormatter,i=new e.MapDataService((void 0),t.descriptor,n),o=new e.MapService(t.tenantId,t.event),s=new e.MapViewModel(t.event,t.descriptor.chatterId,i,o);return s}},template:{element:"map-template"},synchronous:!0})}(window.system||(window.system={}),ko,Cookies),function(e,t){e.MapViewModel=function(n,i,o,s){var r=this;r.chatters=t.observableArray(),r.chatter=t.observable(),r.mapper=new e.BaseChatterMapper,r.selectedChatter=t.observable(void 0),r.chatterIsSelected=t.observable(!1),r.chatterIsGeolocated=t.observable(window.geolocation.checkGeolocation()),r.onChattersListUpdated=function(e,t){r.chatters(t)};var a=n.subscribe("ChattersListUpdated",r.onChattersListUpdated);r.onMarkerClicked=function(e,t){r.chatterIsSelected(!0);o.getChatter(t).done(function(e){r.selectedChatter(r.mapper.mapChatterToViewModel(e))}).fail(function(e){})};var c=n.subscribe("MarkerClicked",r.onMarkerClicked);r.onChatterUnselected=function(e){r.unselectChatter()};var d=n.subscribe("UnselectChatter",r.onChatterUnselected);r.chatters.subscribe(function(e){void 0!==r.chatter()&&e.length>0&&r.updateMapWithChatters(e)}),r.chatter.subscribe(function(e){r.chatters().length>0&&void 0!==e&&null!==e&&(r.isAlreadyInChatters(e.id)?r.updateMapWithChatters(r.chatters()):(r.unselectChatter(),r.chatters.push(e)))}),r.isAlreadyInChatters=function(e){for(var t=0;t<r.chatters().length;t++)if(e===r.chatters()[t].id)return!0;return!1},r.updateMapWithChatters=function(e){r.unselectChatter(),s.addChattersToMap(r.filterGeolocalizedChatters(e))},r.getChatter=function(e){o.getChatter(e).done(function(e){e.vip?r.initializeMapWith(e):window.feedBack.FeatureReservedForVIP()}).fail(function(e){window.feedBack.handleError(e,null)})},r.initializeMapWith=function(e){s.initializeMapWith(e),r.chatter(e)},r.filterGeolocalizedChatters=function(e){return e.filter(function(e){return r.chatterIsGeolocalized(e)})},r.chatterIsGeolocalized=function(e){return e.longitude!==-1&&e.latitude!==-1},r.unselectChatter=function(){r.chatterIsSelected(!1),r.selectedChatter(void 0)},r.getProfileUrl=function(){return"/Chat#/profile/".concat(encodeURI(r.selectedChatter().id))},r.mapIsDisabled=t.pureComputed(function(){return r.chatterIsGeolocated()===!1}),r.mapIsEnabled=t.pureComputed(function(){return!r.mapIsDisabled()}),r.initializeMapIfEnabled=function(){r.mapIsEnabled()&&r.getChatter(i)},r.onGeolocationStatement=function(e,t){r.chatterIsGeolocated(t)};var u=n.subscribe("GeolocationStatement",r.onGeolocationStatement);r.onMainRegionChanged=function(e,t){r.chatterIsGeolocated(window.geolocation.checkGeolocation()),window.setTimeout(r.initializeMapIfEnabled,500)};var l=n.subscribe("MainRegionChanged",r.onMainRegionChanged);r.dispose=function(){n.unsubscribe(a),n.unsubscribe(c),n.unsubscribe(d),n.unsubscribe(u),n.unsubscribe(l)}}}(window.system||(window.system={}),ko),function(e,t){t.components.register("singlemap",{viewModel:{createViewModel:function(t){var n=new e.MapService(t.tenantId,t.event),i=new e.SingleMapViewModel(t.event,t.me,t.other,n);return i}},template:{element:"single-map-template"},synchronous:!0})}(window.system||(window.system={}),ko),function(e,t){e.SingleMapViewModel=function(e,n,i,o){var s=this;s.me=t.unwrap(n),s.me.isGeolocalized=s.me.latitude!==-1&&s.me.longitude!==-1,s.other=t.unwrap(i),s.distanceWithOther,s.initializeMapWith=function(e){o.initializeMapWith(e)},s.getRoundedDistance=function(e){return Math.round(e/1e3)},s.chatterIsGeolocalized=function(e){return e.longitude!==-1&&e.latitude!==-1},s.filterGeolocalizedChatters=function(e){return e.filter(function(e){return s.chatterIsGeolocalized(e)})},s.getDistanceWithOther=function(){return s.me.isGeolocalized&&s.chatterIsGeolocalized(s.other)?s.getRoundedDistance(o.getDistanceBetween(s.me,s.other)):0},s.initialize=function(){s.initializeMapWith(s.me),o.addChattersToMap(s.filterGeolocalizedChatters([s.me,s.other])),s.distanceWithOther=s.getDistanceWithOther()},s.initialize()}}(window.system||(window.system={}),ko),function(e,t,n){t.initializeRoutes=function(){var e={"/home":function(){n.publish("HomeRouted",{}),n.publish("CommandSent",{}),window.analytics.trackPageView("/chats/#panel-default","Chat/Home")},"/profile/([._a-zA-Z0-9-\\%]+)":{on:function(e){n.publish("ProfileRouted",decodeURIComponent(e)),n.publish("CommandSent",{})}},"/conversation/([._a-zA-Z0-9-\\%]+)":{on:function(e){n.publish("ConversationRouted",decodeURI(e)),n.publish("CommandSent",{}),window.analytics.trackPageView("/chats/modal-conversation-frame","Chat/Conversation")}},"/newinterlocutors":function(){n.publish("NewInterlocutorsRouted",{}),n.publish("CommandSent",{}),window.analytics.trackPageView("/chats/#panel-waiting","Chat/NewInterlocutors")},"/search":function(){n.publish("SearchRouted",{}),n.publish("CommandSent",{}),window.analytics.trackPageView("/chats/#panel-search","Chat/Search")},"/map":function(){n.publish("MapRouted",{}),n.publish("CommandSent",{}),window.analytics.trackPageView("/chats/#panel-geo","Chat/Map")}},i=t(e);return i.init(),i}}(window.system||(window.system={}),Router,PubSub),function(e,t){e.ChatViewModel=function(e,n,i){var o=this;o.mainRegion=t.observable("home"),o.event=e,o.descriptor=n,o.tenantId=i,o.isMobile=t.observable(!1),o.isInDynamicContentPage=t.pureComputed(function(){return"conversation"===o.mainRegion()||"search"===o.mainRegion()}),o.isNotInDynamicContentPage=t.pureComputed(function(){return"conversation"!==o.mainRegion()&&"search"!==o.mainRegion()}),o.homeTemplate=t.pureComputed(function(){return o.isMobile()?"home":"search"}),o.isInConversationRegion=t.pureComputed(function(){return"conversation"===o.mainRegion()}),o.isNotInConversationRegion=t.pureComputed(function(){return"conversation"!==o.mainRegion()}),o.isInHomeRegion=t.pureComputed(function(){return"home"===o.mainRegion()}),o.isInSearchRegion=t.pureComputed(function(){return"search"===o.mainRegion()}),o.isInMapRegion=t.pureComputed(function(){return"map"===o.mainRegion()}),o.onHomeRouted=function(e,t){o.mainRegion("home"),o.event.publish("MainRegionChanged",o.descriptor.chatterId)},o.event.subscribe("HomeRouted",o.onHomeRouted),o.onConversationRouted=function(e,t){o.descriptor.chatterId!==t&&(o.mainRegion("conversation"),o.event.publish("MainRegionChanged",t))},o.event.subscribe("ConversationRouted",o.onConversationRouted),o.onProfileRouted=function(e,t){o.mainRegion("profile"),o.event.publish("MainRegionChanged",t)},o.event.subscribe("ProfileRouted",o.onProfileRouted),o.onSearchRouted=function(e,t){o.mainRegion("search"),o.event.publish("MainRegionChanged",{})},o.event.subscribe("SearchRouted",o.onSearchRouted),o.onMapRouted=function(e,t){o.event.publish("MainRegionChanged",{}),o.mainRegion("map")},o.event.subscribe("MapRouted",o.onMapRouted),o.onNewInterlocutorsRouted=function(e,t){o.mainRegion("newinterlocutors"),o.event.publish("MainRegionChanged",o.descriptor.chatterId)},o.event.subscribe("NewInterlocutorsRouted",o.onNewInterlocutorsRouted),o.componentXSIsVisible=t.observable(!1),o.componentXSIsHidden=t.pureComputed(function(){return!o.componentXSIsVisible()}),o.onMobileVisibilityChange=function(e,t){o.componentXSIsVisible(t.isVisible),o.isMobile(t.isVisible)},e.subscribe("VisibleIfMobile",o.onMobileVisibilityChange),o.initialize=function(){o.event.publish("MainRegionChanged",o.descriptor.chatterId)}}}(window.system||(window.system={}),ko),function(e,t){t.components.register("home",{viewModel:{createViewModel:function(t){var n=new e.HttpHeaderFormatter,i=new e.HomeDataService((void 0),t.descriptor,n,t.tenantId),o=new e.HomeViewModel(t.event,i);return o}},template:{element:"home-template"},synchronous:!0})}(window.system||(window.system={}),ko),function(e,t){e.HomeViewModel=function(n,i){var o=this;o.numberOfOnlineChatters=t.observable(0),o.mapper=new e.BaseChatterMapper,o.chatter=t.observable(),o.onMainRegionChanged=function(e,t){o.updateNumberOfOnlineChatters(),o.getChatter(t)};var s=n.subscribe("MainRegionChanged",o.onMainRegionChanged);o.numberFirstPart=t.pureComputed(function(){var e=Math.floor(o.numberOfOnlineChatters()/1e3);return 0===e?"":e.toString()}),o.numberSecondPart=t.pureComputed(function(){var e=o.numberOfOnlineChatters()%1e3;return e<10?"00".concat(e.toString()):e<100?"0".concat(e.toString()):e.toString()}),o.updateNumberOfOnlineChatters=function(){},o.getChatter=function(e){},o.dispose=function(){n.unsubscribe(s)}}}(window.system||(window.system={}),ko),function(e,t){t.components.register("flashmessaging",{viewModel:{createViewModel:function(t){var n=new e.HttpHeaderFormatter,i=new e.FlashMessagingDataService((void 0),t.descriptor,n),o=new e.FlashMessagingViewModel(t.event,t.descriptor.chatterId,t.recipientId,t.recipientName,i);return o}},template:{element:"flash-messaging-template"},synchronous:!0})}(window.system||(window.system={}),ko),function(e,t,n){e.FlashMessagingViewModel=function(e,i,o,s,r){var a=this;a.text=t.observable(),a.lastMessageSent=t.observable(),a.recipientName=s,a.suggestion=t.observable(),a.flashMessageIsVisible=t.observable(!1),a.canSendFlashMessage=t.pureComputed(function(){return void 0!==a.lastMessageSent()&&(""===a.lastMessageSent()||!a.messageHasBeenSentRecently(a.lastMessageSent())||void 0!==a.lastMessageSent().senderId&&a.lastMessageSent().senderId!==i)}),a.canNotSendFlashMessage=t.pureComputed(function(){return!a.canSendFlashMessage()}),a.textIsValid=t.pureComputed(function(){return void 0!==a.text()&&""!==a.text()}),a.showConversation=function(){e.publish("CommandSent",{}),e.publish("ConversationClicked",o)},a.suggestionChanged=function(){a.text(a.suggestion())},a.sendOnEnter=function(e,t){return 13!==t.keyCode||!a.textIsValid()||(a.sendMessage(),!1)},a.sendMessage=function(){window.spinner.show(),"NavigateToConversation"==a.text()?a.showConversation():r.sendMessage(o,a.text()).done(function(e){a.lastMessageSent({text:a.text(),date:new Date}),a.text(""),window.spinner.hide()}).fail(function(e){window.spinner.hide();var t=new window.system.Message(e.responseText,n.Error),i=404===e.status&&"Request sender not found"!==e.statusText?function(){}:a.finishConversation;window.feedBack.handleError(e,t,i)})},a.getLastMessageSent=function(){r.getLastMessageSentTo(o).done(function(e){a.lastMessageSent(e),a.flashMessageIsVisible(!0)}).fail(function(e){window.feedBack.handleError(e,null)})},a.messageHasBeenSentRecently=function(e){var t=new Date(e.date),n=new Date;return n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()},a.getLastMessageSent()}}(window.system||(window.system={}),ko,system.MessageType),function(e,t,n){e.RatingViewModel=function(i,o,s,r){function a(e){this.value=e,this.passed=t.pureComputed(function(){return c.rate()>=this.value},this)}var c=this;c.mapper=new e.BaseChatterMapper,c.savedRate,c.rate=s().rate,c.other=s,c.me=o,c.canRate=t.pureComputed(function(){return void 0!==c.other()&&void 0!==c.me()&&c.me().id!==c.other().id&&c.me().vip&&c.other().vip}),c.rates=[new a(1),new a(2),new a(3),new a(4)],c.rateChatter=function(e){r.rateVip(c.other().id,e.value).done(function(e){i.publish("CommandSent",{}),i.publish("RatingSuccess",{}),c.rate(e)}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);c.me().vip?window.feedBack.handleError(e,t):window.feedBack.encourageToRegister(t)})},c.selectRate=function(e){c.savedRate=c.rate(),c.rate(e.value)},c.unselectRate=function(){c.rate(c.savedRate)}}}(window.system||(window.system={}),ko,system.MessageType),function(e,t){t.components.register("rating",{viewModel:{createViewModel:function(t){var n=new e.HttpHeaderFormatter,i=new e.RatingDataService((void 0),t.descriptor,n),o=new e.RatingViewModel(t.event,t.me,t.other,i);return o}},template:{element:"rating-template"},synchronous:!0})}(window.system||(window.system={}),ko),function(e,t){t.components.register("chattercontact",{viewModel:{createViewModel:function(t){var n=new e.HttpHeaderFormatter,i=new e.ContactDataService((void 0),t.descriptor,n),o=new e.ChatterContactViewModel(t.templateName,t.event,t.me,t.other,i);return o}},template:{element:"chatter-contact-template"},synchronous:!0})}(window.system||(window.system={}),ko),function(e,t,n){e.ChatterContactViewModel=function(i,o,s,r,a){var c=this;c.templateName=i,c.mapper=new e.BaseChatterMapper,c.other=r,c.isAd=2===r().type,c.chatterContactIsVisible=t.pureComputed(function(){return s().id!==c.other().id}),c.canBlacklist=t.pureComputed(function(){return s().id!==c.other().id&&!c.other().blacklisted()&&c.other().vip}),c.canAddToFavorites=t.pureComputed(function(){return s().id!==c.other().id&&!c.other().favorite()&&c.other().vip}),c.addToFavorites=function(){a.addToFavorites(c.other().id).done(function(e){c.other().favorite(!0),c.other().blacklisted(!1),o.publish("CommandSent",{})}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);s().vip?window.feedBack.handleError(e,t):window.feedBack.encourageToRegister(t)})},c.addToBlacklist=function(){a.addToBlacklist(c.other().id).done(function(t){c.other().blacklisted(!0),c.other().favorite(!1),o.publish("CommandSent",{});var n=new window.system.Message(window.getFeedbackMessageResource("userBlacklisted"),e.MessageType.Info);window.feedBack.blacklistUser(n)}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);s().vip?window.feedBack.handleError(e,t):window.feedBack.encourageToRegister(t)})},c.deleteFromFavorites=function(){a.deleteFromFavorites(c.other().id).done(function(e){c.other().favorite(!1),o.publish("CommandSent",{})}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)})},c.deleteFromBlacklist=function(){a.deleteFromBlacklist(c.other().id).done(function(e){c.other().blacklisted(!1),o.publish("CommandSent",{})}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)})},c.reportAbuseOnProfile=function(){if(s().vip){var t=new window.system.Message(window.getFeedbackMessageResource("reportAbuseProfile"),e.MessageType.Warning);window.feedBack.confirmReportAbuse(t,c.reportAbuseOnProfileAction)}else window.feedBack.FeatureReservedForVIP()},c.reportAbuseOnProfileAction=function(){window.spinner.show(),a.reportAbuseOnProfile(c.other().id).done(function(e){window.spinner.hide(),o.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource("positiveFeedback"),n.Success))}).fail(function(e){window.spinner.hide(),o.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource("positiveFeedback"),n.Success))})}}}(window.system||(window.system={}),ko,system.MessageType),function(e,t,n){t.components.register("media",{viewModel:{createViewModel:function(t){var i=new e.HttpHeaderFormatter,o=new e.MediaDataService((void 0),t.descriptor,i),s=new e.MediaViewModel(t.templateName,t.event,t.medias,n,o);return s}},template:{element:"media-template"},synchronous:!0})}(window.system||(window.system={}),ko,window.capabilities),function(e,t,n){e.MediaViewModel=function(i,o,s,r,a){var c=this;c.medias=t.observableArray(s),c.selectedMedia=t.observable(),c.templateName=i,c.selectedPublicPicture=t.observable(),c.selectedPublicVideo=t.observable(),c.selectedPrivatePicture=t.observable(),c.selectedPrivateVideo=t.observable(),c.navigationIsVisible=t.pureComputed(function(){return c.publicPhotos().length>1}),c.selectMedia=function(e){o.publish("MediaSelected",e),c.selectedMedia(e)},c.selectPublicPicture=function(e){c.unselectPublicVideo(),c.selectedPublicPicture(c.getMasterMedia(e)),c.selectedMedia(c.selectedPublicPicture())},c.unselectPublicPicture=function(e){c.selectedPublicPicture(void 0),c.selectedMedia(void 0)},c.selectPublicVideo=function(e){c.unselectPublicPicture(),c.selectedPublicVideo(c.getMasterMedia(e)),c.selectedMedia(c.selectedPublicVideo())},c.unselectPublicVideo=function(e){c.selectedPublicVideo(void 0),c.selectedMedia(void 0)},c.selectPrivatePicture=function(e){c.selectedPrivatePicture(c.getMasterMedia(e)),c.selectedMedia(c.selectedPrivatePicture())},c.unselectPrivatePicture=function(e){c.selectedPrivatePicture(void 0),c.selectedMedia(void 0)},c.selectPrivateVideo=function(e){c.selectedPrivateVideo(c.getMasterMedia(e)),c.selectedMedia(c.selectedPrivateVideo())},c.unselectPrivateVideo=function(e){c.selectedPrivateVideo(void 0),c.selectedMedia(void 0)},c.getMasterMedia=function(e){return e.url=e.url.replace("&w=300&h=300&maxSize=15000","").replace("&w=150&h=150&maxSize=15000",""),e},c.unselectMedia=function(e){o.publish("CommandSent",{}),o.publish("MediaUnselected",e),c.selectedMedia(void 0)},c.getBackgroundStyledPictureUrl=function(e){return"url("+e+")"},c.isActive=function(e){return 0===e},c.hasPublicMedias=t.pureComputed(function(){return c.publicPhotos().length>0||c.publicVideos().length>0}),c.hasPublicPhotos=t.pureComputed(function(){return c.publicPhotos().length>0}),c.hasPublicVideos=t.pureComputed(function(){return c.publicVideos().length>0}),c.hasPrivateMedias=t.pureComputed(function(){return c.privatePhotos().length>0||c.privateVideos().length>0}),c.hasPrivatePhotos=t.pureComputed(function(){return c.privatePhotos().length>0}),c.hasPrivateVideos=t.pureComputed(function(){return c.privateVideos().length>0}),c.hasPhotos=t.pureComputed(function(){return c.publicPhotos().length>0||c.privatePhotos().length>0}),c.hasVideos=t.pureComputed(function(){return c.publicVideos().length>0||c.privateVideos().length>0}),c.photos=t.pureComputed(function(){return c.medias().filter(function(e){return 0===e.type})}),c.videos=t.pureComputed(function(){return c.medias().filter(function(e){return 1===e.type})}),c.publicPhotos=t.pureComputed(function(){return c.medias().filter(function(e){return 0===e.type&&!e["private"]})}),c.publicVideos=t.pureComputed(function(){return c.medias().filter(function(e){return 1===e.type&&!e["private"]})}),c.privatePhotos=t.pureComputed(function(){return c.medias().filter(function(e){return 0===e.type&&e["private"]})}),c.privateVideos=t.pureComputed(function(){return c.medias().filter(function(e){return 1===e.type&&e["private"]})}),c.unselectSelectedMedia=function(){c.selectedMedia(void 0),c.selectedPublicPicture(void 0),c.selectedPublicVideo(void 0),c.selectedPrivatePicture(void 0),c.selectedPrivateVideo(void 0)},c.showSuccessFeedback=function(e){var t;"image"===e&&(t="settingsAlbumsPicture"),"video"===e&&(t="settingsAlbumsVideo"),"profilePicture"===e&&(t="settingsPendingProfilePicture"),o.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource(t),n.Success))},c.showMoreInfoPublicAlbum=function(){window.feedBack.showAlbumsMoreInfos("publicAlbumInfosTitle","publicAlbumInfos")},c.showMoreInfoPrivateAlbum=function(){window.feedBack.showAlbumsMoreInfos("privateAlbumInfosTitle","privateAlbumInfos")},c.addPublicMedia=function(t,i){if(o.publish("CommandSent",{}),r.supportFileApi()){window.spinner.show();var s=i.target.files,d=s[0].type.split("/");if("image"!=d[0]){window.spinner.hide();var u=new window.system.Message(window.getFeedbackMessageResource("fileTypeNotSupported"),e.MessageType.Error);return void window.feedBack.showSweetAlert(u)}a.uploadPublicMedia(s[0]).done(function(e){c.showSuccessFeedback(d[0]),window.spinner.hide()}).fail(function(e){window.spinner.hide();var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)})}},c.addPrivateMedia=function(t,i){if(o.publish("CommandSent",{}),r.supportFileApi()){window.spinner.show();var s=i.target.files,d=s[0].type.split("/");if("image"!=d[0]){window.spinner.hide();var u=new window.system.Message(window.getFeedbackMessageResource("fileTypeNotSupported"),e.MessageType.Error);return void window.feedBack.showSweetAlert(u)}a.uploadPrivateMedia(s[0]).done(function(e){c.showSuccessFeedback(d[0]),window.spinner.hide()}).fail(function(e){window.spinner.hide();var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)})}},c.selectToDelete=function(e){c.selectedMedia(e),c.deleteMedia()},c.deleteMedia=function(){o.publish("CommandSent",{}),a.deleteMedia(c.selectedMedia().id).done(function(e){
c.medias.remove(c.selectedMedia()),c.unselectSelectedMedia(),o.publish("SliderChanged",{})}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)})},c.defineAsProfilePicture=function(e){o.publish("CommandSent",{}),a.defineAsProfilePicture(e).done(function(e){c.showSuccessFeedback("profilePicture")}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)})},c.switchStatusMedia=function(e){o.publish("CommandSent",{}),a.switchStatusMedia(e).done(function(t){c.medias.remove(c.selectedMedia()),c.selectedMedia()["private"]=!e["private"],c.medias.push(c.selectedMedia()),c.unselectSelectedMedia(),o.publish("SliderChanged",{}),o.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource("positiveFeedback"),n.Success))}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)})},c.reportAbuseOnMedia=function(){var t=new window.system.Message(window.getFeedbackMessageResource("reportAbuseMedia"),e.MessageType.Warning);window.feedBack.confirmReportAbuse(t,c.reportAbuseOnMediaAction)},c.reportAbuseOnMediaAction=function(){window.spinner.show(),a.reportAbuseOnMedia(c.selectedMedia()).done(function(e){window.spinner.hide(),o.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource("positiveFeedback"),n.Success))}).fail(function(e){window.spinner.hide(),o.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource("positiveFeedback"),n.Success))})}}}(window.system||(window.system={}),ko,system.MessageType),function(e,t,n,i){e.CustomSlider=function(){this.init=function(e,o){function s(e){var t=n(e).find(".slider");t.hasClass("hidden")||t.addClass("hidden"),n(e).hasClass("loading")||n(e).addClass("loading");var i=t.children().length,o=t.children().outerWidth(!0)+5,s=o*i;t.width(s),s>n(e).width()?n(e).find(".slider-btn").removeClass("hidden"):n(e).find(".slider-btn").addClass("hidden"),t.removeClass("hidden"),n(e).removeClass("loading")}function r(e,t,i){var o=n(e).find(".slider");if(!u){u=!0;var s=o.find(".slide").width()*i;o.animate({marginLeft:-s},t,function(){n(this).css({marginLeft:0}).find("li:last").after(n(this).find("li:first")),u=!1})}}function a(e,t,i){var o=n(e).find(".slider");if(!u){u=!0;var s=o.find(".slide").width()*i;o.css({marginLeft:-s}).find("li:first").before(o.find("li:last")),o.animate({marginLeft:0},t,function(){u=!1})}}var c=t.unwrap(o()),d=c.duration,u=!1;i.subscribe("SliderChanged",function(t,n){s(e)}),window.setTimeout(function(){s(e)},500),n(e).find(".slider-btn").unbind("click"),n(e).find(".slider-btn").bind("click",function(){u||(n(this).hasClass("next")?r(e,d,c.nbSlides):a(e,d,c.nbSlides))}),n(window).resize(function(){s(e)})}},t.bindingHandlers.customSlider=new e.CustomSlider}(window.system||(window.system=system),ko,jQuery,PubSub),function(e,t,n){e.ScrollTo=function(){this.init=function(e,t){var i=t();i.duration?n(i.container).animate({scrollTop:n(i.element).offset().top-n(i.container).offset().top+n(i.container).scrollTop()},i.duration):n(i.container).scrollTop(n(i.element).offset().top-n(i.container).offset().top+n(i.container).scrollTop())}},t.bindingHandlers.scrollTo=new e.ScrollTo}(window.system||(window.system=system),ko,jQuery),function(e,t){t.components.register("profile",{viewModel:{createViewModel:function(t){var n=new e.HttpHeaderFormatter,i=new e.ProfileDataService((void 0),t.descriptor,n),o=new e.ProfileViewModel(t.event,t.descriptor,i);return o}},template:{element:"profile-template"},synchronous:!0})}(window.system||(window.system={}),ko),function(e,t,n){e.ProfileViewModel=function(i,o,s){var r=this;r.mapper=new e.ProfileChatterMapper,r.me=t.observable(),r.event=i,r.other=t.observable(),r.descriptor=o,r.mapIsVisible=t.observable(!1),r.profilePictureIsVisible=t.observable(!1),r.otherIsDisconnected=t.observable(!1),r.errorProfile=t.observable(""),r.chatterIsGeolocated=t.observable(window.geolocation.checkGeolocation()),r.otherConnectedOn=t.observable(),r.isRelativelyPopular=t.pureComputed(function(){return null===r.other().rate()||void 0===r.other().rate()||r.other().rate()>=-1&&r.other().rate()<2}),r.isPrettyPopular=t.pureComputed(function(){return r.other().rate()>=2&&r.other().rate()<3}),r.isVeryPopular=t.pureComputed(function(){return r.other().rate()>=3&&r.other().rate()<=4}),r.mapIsDisabled=t.pureComputed(function(){return r.chatterIsGeolocated()===!1}),r.mapIsEnabled=t.pureComputed(function(){return!r.mapIsDisabled()}),r.canChat=t.pureComputed(function(){return void 0!==r.other()&void 0!==r.me()&&r.other().id!==r.me().id&&r.other().connected}),r.mapButtonIsVisible=t.pureComputed(function(){return r.other().isGeolocalized&&window.configuration.mapActionIsEnabled()}),r.showConversation=function(){i.publish("CommandSent",{}),i.publish("ConversationClicked",r.other().id)},r.reportAbuseOnProfile=function(){if(r.me().vip){var t=new window.system.Message(window.getFeedbackMessageResource("reportAbuseProfile"),e.MessageType.Warning);window.feedBack.confirmReportAbuse(t,r.reportAbuseOnProfileAction)}else window.feedBack.FeatureReservedForVIP()},r.reportAbuseOnProfileAction=function(){window.spinner.show(),s.reportAbuseOnProfile(r.other().id).done(function(e){window.spinner.hide(),r.event.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource("positiveFeedback"),n.Success))}).fail(function(e){window.spinner.hide(),r.event.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource("positiveFeedback"),n.Success))})},r.showHideMap=function(){r.me().vip?r.mapIsDisabled()?r.mapIsVisible()?r.mapIsVisible(!1):window.feedBack.encourageToActivateGeolocation(r.promptGeoloc):(r.mapIsVisible(!r.mapIsVisible()),r.mapIsVisible()&&window.analytics.trackPageView("/modal-geo","Chat/Profile/ShowMap")):window.feedBack.FeatureReservedForVIP()},r.showHideProfilePicture=function(){r.profilePictureIsVisible(!r.profilePictureIsVisible()),r.profilePictureIsVisible()&&window.analytics.trackPageView("/modal-photo","Chat/Profile/ShowProfilePicture")},r.promptGeoloc=function(){r.event.publish("PromptGeolocation",{})},r.onGeolocationStatement=function(e,t){r.chatterIsGeolocated(t)};var a=i.subscribe("GeolocationStatement",r.onGeolocationStatement);r.onMainRegionChanged=function(e,t){$('[id^="recaptcha"]').remove(),$(".chatter-actions").prepend('<div id="recaptchaProfile" class="g-recaptcha" style="position: fixed; top: 25%; left: 50%; z-index: 1000;"></div>'),$(".chatter-contact-container").prepend('<div id="recaptchaProfile" class="g-recaptcha" style="position: fixed; top: 25%; left: 10%; z-index: 1000;"></div>'),$(".content-body").prepend('<div id="recaptchaMessage" class="g-recaptcha" style="position: fixed; top: 25%; left: 50%; z-index: 1000;"></div>'),r.getChatterProfile(t),r.chatterIsGeolocated(window.geolocation.checkGeolocation())};var c=r.event.subscribe("MainRegionChanged",r.onMainRegionChanged);r.onProfilePictureClicked=function(e,t){r.showHideProfilePicture()};var d=r.event.subscribe("ProfilePictureClicked",r.onProfilePictureClicked);r.onRatingSuccess=function(e,t){r.event.publish("SuccessFeedback",new window.system.Message(window.getFeedbackMessageResource("ratingSuccess"),n.Success))};var u=r.event.subscribe("RatingSuccess",r.onRatingSuccess);r.getChatterProfile=function(e){window.spinner.show(),r.profilePictureIsVisible(!1),s.getProfile(e).done(function(e){window.spinner.hide(),r.other(r.mapper.mapToViewModel(e)),r.errorProfile(""),r.otherIsDisconnected(!e.connected);var t=moment(),n=t.clone().startOf("day"),i=t.clone().subtract(1,"days").startOf("day"),o=t.clone().subtract(7,"days").startOf("day"),s=t.clone().subtract(1,"months").startOf("day");moment.locale(window.getFirstOrDefaultNavigatorLanguage());var a=moment(r.other().lastVisit,"L"),c="";if(a.isSame(n,"d")&&(c=window.getFeedbackMessageResource("today")),a.isSame(i,"d")&&""==c&&(c=window.getFeedbackMessageResource("yesterday")),a.isAfter(o,"d")&&""==c&&(c=window.getFeedbackMessageResource("thisWeek")),a.isAfter(s,"d")&&""==c&&(c=window.getFeedbackMessageResource("thisMonth")),""==c&&(c=window.getFeedbackMessageResource("recently")),r.otherConnectedOn(c),r.otherIsDisconnected()){var d=t.clone().subtract(1,"hours").startOf("day");a<d?window.analytics.trackPageView("/chats/#panel-profile-offline","Chat/Profile/Offline"):window.analytics.trackPageView("/chats/#panel-profile","Chat/Profile")}else window.analytics.trackPageView("/chats/#panel-profile","Chat/Profile")}).fail(function(e){if(window.spinner.hide(),404===e.status&&"Request sender not found"!==e.statusText)r.other(void 0),r.otherIsDisconnected(!0),r.errorProfile(e.responseText);else{var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)}})},r.getMyProfile=function(){s.getProfile(r.descriptor.chatterId).done(function(e){r.me(e)}).fail(function(e){var t=new window.system.Message(e.responseText,n.Error);window.feedBack.handleError(e,t)})},r.getMyProfile(),r.refreshChattersList=function(){i.publish("RefreshChattersList",{})},r.dispose=function(){r.event.unsubscribe(c),r.event.unsubscribe(d),r.event.unsubscribe(u),r.event.unsubscribe(a)}}}(window.system||(window.system={}),ko,system.MessageType),function(e,t){t.components.register("newinterlocutors",{viewModel:{createViewModel:function(t){var n=new e.HttpHeaderFormatter,i=new e.NewInterlocutorDataService((void 0),t.descriptor,n),o=new e.NewInterlocutorViewModel(t.event,i);return o}},template:{element:"new-interlocutor"},synchronous:!0})}(window.system||(window.system={}),ko),function(e){e.NewInterlocutorDataService=function(t,n,i){var o=this;o.base=e.ChatDataService,o.base(t,n,i),o.getNewInterlocutors=function(e){return window.location.href.indexOf("club")==-1?o.get("chatters/".concat(encodeURI(e),"/interlocutors?incomingnewmessages=true"),{}):o.get("chatters/".concat(encodeURI(e),"/interlocutors?incomingnewmessages=true&interlocutorOnlyOnline=true"),{})},o.deleteInterlocutor=function(e){return o["delete"]("chatters/".concat(encodeURI(n.chatterId),"/interlocutors/",encodeURI(e)))}},e.NewInterlocutorDataService.prototype=new e.ChatDataService}(window.system||(window.system={})),function(e,t){e.NewInterlocutorViewModel=function(n,i){var o=this;o.event=n,o.mapper=new e.BaseChatterMapper,o.interlocutors=t.observableArray(),o.interlocutorsHasBeenUpdated=t.observable(!1),o.canShowBanner=function(e){return 1===e},o.hasNewInterlocutors=t.pureComputed(function(){return o.interlocutorsHasBeenUpdated()&&o.interlocutors().length>0}),o.hasNoNewInterlocutors=t.pureComputed(function(){return o.interlocutorsHasBeenUpdated()&&0===o.interlocutors().length}),o.showConversation=function(e){o.event.publish("CommandSent",{}),o.event.publish("ConversationClicked",e.id)},o.showProfile=function(e){n.publish("ProfileClicked",e.id),n.publish("CommandSent",{})},o.deleteInterlocutor=function(e){o.event.publish("CommandSent",{}),i.deleteInterlocutor(e.id).done(function(t){o.interlocutors.remove(e),0===o.interlocutors().length&&o.event.publish("NoMoreInterlocutors",{})}).fail(function(e){window.feedBack.handleError(e,null)})},o.onMainRegionChanged=function(e,t){o.getNewInterlocutors(t)};var s=o.event.subscribe("MainRegionChanged",o.onMainRegionChanged);o.onMessageCounterClick=function(e,t){o.getNewInterlocutors(t)};var r=o.event.subscribe("MessageCounterClicked",o.onMessageCounterClick);o.getNewInterlocutors=function(e){i.getNewInterlocutors(e).done(function(e){o.mapper.mapChattersToViewModel(e),o.interlocutors(e),o.interlocutorsHasBeenUpdated(!0)}).fail(function(e){window.feedBack.handleError(e,null)})},o.dispose=function(){o.event.unsubscribe(s),o.event.unsubscribe(r)}}}(window.system||(window.system={}),ko),function(e){e.EmoticonFactory=function(){this.createEmoticons=function(){var t=[new e.Emoticon("emoji1",["😀"]),new e.Emoticon("emoji2",["😁"]),new e.Emoticon("emoji3",["😂"]),new e.Emoticon("emoji4",["😅"]),new e.Emoticon("emoji5",["😆"]),new e.Emoticon("emoji6",["😇"]),new e.Emoticon("emoji7",["😍"]),new e.Emoticon("emoji8",["😎"]),new e.Emoticon("emoji9",["😏"]),new e.Emoticon("emoji10",["😐"]),new e.Emoticon("emoji11",["😒"]),new e.Emoticon("emoji12",["😕"]),new e.Emoticon("emoji13",["😘"]),new e.Emoticon("emoji14",["😡"]),new e.Emoticon("emoji15",["😦"]),new e.Emoticon("emoji16",["😨"]),new e.Emoticon("emoji17",["😬"]),new e.Emoticon("emoji18",["😭"]),new e.Emoticon("emoji19",["😮"]),new e.Emoticon("emoji20",["😳"]),new e.Emoticon("emoji21",["😴"]),new e.Emoticon("emoji22",["😶"]),new e.Emoticon("emoji23",["😷"]),new e.Emoticon("emoji24",["🙂"]),new e.Emoticon("emoji25",["🙄"]),new e.Emoticon("emoji26",["🤐"]),new e.Emoticon("emoji27",["🤓"]),new e.Emoticon("emoji28",["🤔"]),new e.Emoticon("emoji29",["🤣"]),new e.Emoticon("emoji30",["🤨"]),new e.Emoticon("emoji31",["🤩"]),new e.Emoticon("emoji32",["🤪"]),new e.Emoticon("emoji33",["🤫"]),new e.Emoticon("emoji34",["🥰"]),new e.Emoticon("emoji35",["🥵"]),new e.Emoticon("emoji36",["🥶"]),new e.Emoticon("emoji37",["🧐"])];return t}}}(window.system||(window.system={})),function(e){e.EmoticonService=function(e){var t;this.getEmoticons=function(){return t=void 0===t?e.createEmoticons():t}}}(window.system||(window.system={})),function(e,t){t.components.register("emoticon",{viewModel:{createViewModel:function(t){var n=new e.EmoticonFactory,i=new e.EmoticonService(n),o=new e.EmoticonViewModel(t.event,i);return o}},template:{element:"emoticon-template"},synchronous:!0})}(window.system||(window.system={}),ko),function(e){e.Emoticon=function(e,t){this.getSymbols=function(){return t},this.getCssClass=function(){return e},this.getDefaultSymbol=function(){return t[0]}}}(window.system||(window.system={})),function(e,t){e.EmoticonViewModel=function(e,t){function n(){i.emoticons=t.getEmoticons()}var i=this;i.emoticons,i.selectEmoticon=function(t){e.publish("CommandSent",{}),e.publish("EmoticonSelected",t)},n()}}(window.system||(window.system={}),ko),function(e){e.MessageTextParser=function(e){function t(e,t){return e.indexOf(t)>-1}var n=e.getEmoticons();this.parse=function(e){for(var i,o,s,r,a=[],c=!1,d=0;d<n.length;d++){i=n[d],r=i.getSymbols();for(var u=0;u<r.length;u++)if(t(e,r[u])&&!c){c=!0,o=e.split(r[u]);for(var l=0;l<o.length;l++)s=o[l],""!==s&&(a=a.concat(this.parse(s))),l%2===0&&a.push(i)}}return c===!1&&a.push(e),a}}}(window.system||(window.system={})),function(e,t,n){e.TextEmoticonBinder=function(i){this.init=function(o,s){for(var r,a=t.unwrap(s()),c=i.parse(a),d=0;d<c.length;d++){var u=c[d];r=u instanceof e.Emoticon?n("<span />").addClass("smiley").addClass(u.getCssClass()):n("<span />").addClass("text-message").html(u),n(o).append(r)}}};var i=new e.EmoticonService(new e.EmoticonFactory),o=new e.MessageTextParser(i);t.bindingHandlers.textWithEmoticon=new e.TextEmoticonBinder(o)}(window.system||(window.system=system),ko,jQuery),function(e,t,n){e.AutomaticScrollDown=function(){function e(e){n(e).animate({scrollTop:n(e)[0].scrollHeight},500)}this.init=function(t){e(t)},this.update=function(n,i){t.unwrap(i()),e(n)}},t.bindingHandlers.automaticScrollDown=new e.AutomaticScrollDown}(window.system||(window.system=system),ko,jQuery),function(e,t,n){t.components.register("conversation",{viewModel:{createViewModel:function(t){var i=new e.HttpHeaderFormatter,o=new e.CookieService(n),s=new e.ConversationDataService((void 0),t.descriptor,i),r=new e.ConversationController(t.event,s),a=new e.ConversationViewModel(t.event,t.descriptor,o,s,r.dispose);return a}},template:{element:"conversation-template"},synchronous:!0})}(window.system||(window.system={}),ko,Cookies),function(e,t,n){e.ConversationController=function(e,t){function i(){var e=this;this.offset=10,this.limit=10,this.currentOffset=0,this.lastCount=0,this.start=function(){e.update()},o.currentInterlocutorsOffset.subscribe(function(t){e.limit-1===t&&e.lastCount>e.currentOffset+e.offset?(e.currentOffset+=e.offset,e.update()):e.currentOffset+t+1===e.lastCount&&(e.currentOffset=0,e.update())}),this.update=function(){t.getInterlocutors(e.currentOffset,e.limit).done(function(t,n,i){e.lastCount=parseInt(i.getResponseHeader("Count"),10),o.availableInterlocutors=t,o.currentInterlocutorsOffset(0)}).fail(function(e){})}}var o=this;o.lastInterlocutorId=void 0,o.availableInterlocutors=[],o.currentInterlocutorsOffset=n.observable(0),o.automaticSwitch=!0,o.updator=new i,o.updator.start(),o.onConversationFinished=function(t,n){o.lastInterlocutorId=n;var i=o.getNextInterlocutor();void 0!==i?e.publish("InterlocutorAdded",i.id):e.publish("InterlocutorNotFound",{})};var s=e.subscribe("ConversationFinished",o.onConversationFinished);o.onInterlocutorDeleted=function(t,n){o.lastInterlocutorId=n.interlocutorId,o.automaticSwitch=n.automaticSwitch;var i=o.getNextInterlocutor();void 0!==i&&o.automaticSwitch?e.publish("InterlocutorAdded",i.id):e.publish("InterlocutorNotFound",{})};var r=e.subscribe("InterlocutorDeleted",o.onInterlocutorDeleted);o.getNextInterlocutor=function(){for(var e=void 0,t=o.currentInterlocutorsOffset();t<o.availableInterlocutors.length;t++)if(o.availableInterlocutors[t].id!==o.lastInterlocutorId){e=o.availableInterlocutors[t],o.currentInterlocutorsOffset(t);break}return e},o.dispose=function(){e.unsubscribe(s),e.unsubscribe(r)}}}(window.system||(window.system={}),jQuery,ko),function(e){e.ConversationMessageMapper=function(e,t){var n=this;n.mapConversationToViewModel=function(e){for(var t=0;t<e.length;t++)n.mapMessageToViewModel(e[t])},n.mapMessageToViewModel=function(i){i.senderId=i.senderId||e.id,i.isSentByMe=i.senderId===e.id,i.isSentByOther=i.senderId===t.id,i.isSentByAWoman=i.senderId===e.id&&1===e.gender||i.senderId===t.id&&1===t.gender,i.isSentByAMan=i.senderId===e.id&&0===e.gender||i.senderId===t.id&&0===t.gender,i.mediaIsAPicture=void 0!==i.media&&0===i.media.type,i.mediaIsAVideo=void 0!==i.media&&1===i.media.type,i.mediaIsASound=void 0!==i.media&&2===i.media.type,i.hasMedia=void 0!==i.media&&""!==i.media.id||void 0!==i.media&&2===i.media.type,i.senderName=i.senderId===e.id?e.name:t.name,void 0!==i.media&&n.mapMediaToViewModel(i.media),i.isAd=2===t.type},n.mapMediaToViewModel=function(e){e.url=n.getMasterMedia(e.url),e.urlMP4=e.url+"&f=mp4&ext=.mp4",e.isAPicture=0===e.type,e.isAVideo=1===e.type,e.isASound=2===e.type},n.getMasterMedia=function(e){return e.replace("&w=300&h=300&maxSize=3000","")}}}(window.system||(window.system={})),function(e,t,n,i,o){e.ConversationViewModel=function(s,r,a,c,d){function u(){var t;p.conversationMapper=new e.ConversationMessageMapper(p.sender(),p.recipient());var i=this;i.start=function(){i.updateConversation()},i.forceUpdate=function(){n.clearTimeout(t),i.updateConversation()},i.stop=function(){n.clearTimeout(t)},i.updateConversation=function(){c.getConversation(p.sender().id,p.recipient().id).done(function(e){n.spinner.hide(),p.defineOldestConversationMessagesAsReadIfArent(e),p.conversationMapper.mapConversationToViewModel(e),p.conversation(e),t=n.setTimeout(i.updateConversation,6e3)}).fail(function(e){n.spinner.hide();var t=new n.system.Message(e.responseText,o.Error);n.feedBack.handleError(e,t,p.recipientHasQuit)})}}var l,p=this;p.conversationUpdator,p.conversationMapper,p.chatterMapper=new e.ConversationChatterMapper,p.event=s,p.descriptor=r,p.sender=t.observable(),p.recipient=t.observable(),p.recipientIsDisconnected=t.observable(!1),p.errorProfile=t.observable(""),p.reason=t.observable(""),p.mapIsVisible=t.observable(!1),p.emoticonsAreVisible=t.observable(!1),p.mediasToSendAreVisible=t.observable(!1),p.mediasRecipientAreVisible=t.observable(!1),p.reportFormIsVisible=t.observable(!1),p.mediaSentIsVisible=t.observable(!1),p.mediaSent=t.observable(),p.automaticSwitch=t.observable("true"===a.getAutoNextMessagePreference()),p.message={text:t.observable(""),media:t.observable()},p.conversation=t.observableArray(),p.chatterIsGeolocated=t.observable(n.geolocation.checkGeolocation()),p.automaticSwitch.subscribe(function(e){a.setAutoNextMessagePreference(e)}),p.showProfile=function(){p.event.publish("CommandSent",{}),p.event.publish("ProfileClicked",p.recipient().id)},p.sendMediaButtonIsVisible=t.pureComputed(function(){return void 0!==p.sender()&&p.sender().vip}),p.mapIsDisabled=t.pureComputed(function(){return p.chatterIsGeolocated()===!1}),p.mapIsEnabled=t.pureComputed(function(){return!p.mapIsDisabled()}),p.mapButtonIsVisible=t.pureComputed(function(){return p.recipient().isGeolocalized&&n.configuration.mapActionIsEnabled()}),p.showHideMap=function(){p.sender().vip?p.mapIsDisabled()?p.mapIsVisible()?p.mapIsVisible(!1):n.feedBack.encourageToActivateGeolocation(p.promptGeoloc):(p.event.publish("CommandSent",{}),p.mapIsVisible(!p.mapIsVisible())):n.feedBack.FeatureReservedForVIP()},p.showEmoticons=function(){n.analytics.trackPageView("/list-smiley","Chat/Conversation/ListSmiley"),p.mediasRecipientAreVisible(!1),p.reportFormIsVisible(!1),p.reason("1"),p.mediasToSendAreVisible(!1),p.emoticonsAreVisible(!0)},p.hideEmoticons=function(){p.emoticonsAreVisible(!1)},p.showMediasToSend=function(){n.analytics.trackPageView("/template-modal-photo-send","Chat/Conversation/ModalMediasToSend"),p.mediasRecipientAreVisible(!1),p.reportFormIsVisible(!1),p.reason("1"),p.emoticonsAreVisible(!1),p.mapIsVisible(!1),p.mediasToSendAreVisible(!0)},p.hideMediasToSend=function(){p.mediasToSendAreVisible(!1)},p.showRecipientMedias=function(){p.emoticonsAreVisible(!1),p.mediasToSendAreVisible(!1),p.mapIsVisible(!1),p.mediasRecipientAreVisible(!0)},p.hideRecipientMedias=function(){p.mediasRecipientAreVisible(!1)},p.showReportForm=function(e){n.analytics.trackPageView("/template-modal-report-abuse","Chat/Conversation/ModalReportAbuse"),p.emoticonsAreVisible(!1),p.mediasToSendAreVisible(!1),p.mapIsVisible(!1),l=e.id,p.reportFormIsVisible(!0)},p.hideReportForm=function(){p.reportFormIsVisible(!1),p.reason("1")},p.showMediaSent=function(e){p.mediaSent(e.media),p.mediaSentIsVisible(!0)},p.hideMediaSent=function(){p.mediaSentIsVisible(!1),p.mediaSent(void 0)},p.clearMessage=function(){p.message.text(""),p.message.media(void 0)},p.clearMediaMessage=function(){p.message.media(void 0)},p.getMediaUrl=t.pureComputed(function(){return 0===p.message.media().type?p.message.media().url:p.message.media().urlPreview}),p.refresh=function(){p.mediasRecipientAreVisible(!1),p.reportFormIsVisible(!1),p.reason("1"),p.emoticonsAreVisible(!1),p.mapIsVisible(!1),p.mediasToSendAreVisible(!1),p.conversationUpdator.forceUpdate()},p.sendOnEnter=function(e,t){if(a.getPhoneNumberShareNotificationAlreadyDisplayed()||/\d{5}/.test(i("#sendingMessage").val())&&(n.feedBack.sharePhoneNumberNotification(),a.setPhoneNumberShareNotificationAlreadyDisplayed()),13===t.keyCode){if(!p.canSendMessage())return!1;p.sendMessage()}return!0},p.sendMessage=function(){return!!p.canSendMessage()&&(n.spinner.show(),void c.sendMessage(p.recipient().id,t.toJS(p.message)).done(function(e){if(n.spinner.hide(),p.automaticSwitch())p.finishConversation();else{var i=t.toJS(p.message);p.conversationMapper.mapMessageToViewModel(i),p.conversation.push(i),p.event.publish("CommandSent",{})}p.clearMessage()}).fail(function(e){n.spinner.hide();var t,i;404===e.status&&"Request sender not found"!==e.statusText?(t=new n.system.Message(n.getFeedbackMessageResource("chatOfflineFeedback"),o.Info),i=p.recipientOffline):(t=new n.system.Message(e.responseText,o.Error),i=p.finishConversation),n.feedBack.handleError(e,t,i)}))},p.recipientOffline=function(){p.event.publish("ProfileClicked",p.recipient().id)},p.finishConversation=function(){p.event.publish("ConversationFinished",p.recipient().id)},p.canSendMessage=t.pureComputed(function(){return""!==p.message.text()&&p.message.text().length>1&&0!==p.message.text().replace(/\s/g,"").length||void 0!==p.message.media()}),p.isOtherReason=t.pureComputed(function(){return"5"===p.reason()}),p.sendMessageReport=function(){n.spinner.show(),p.event.publish("CommandSent",{}),c.sendMessageReport(l,p.reason()).done(function(e){n.spinner.hide(),p.hideReportForm();var t=new n.system.Message(n.getFeedbackMessageResource("reportAbuseOnMessageFeedback"),o.Info);n.feedBack.showSweetAlert(t,null)}).fail(function(e){n.spinner.hide();var t=new n.system.Message(e.responseText,o.Error);n.feedBack.handleError(e,t)})},p.deleteInterlocutor=function(){c.deleteInterlocutor(p.recipient().id).done(function(e){p.event.publish("InterlocutorDeleted",{automaticSwitch:p.automaticSwitch(),interlocutorId:p.recipient().id})}).fail(function(e){var t=new n.system.Message(e.responseText,o.Error);n.feedBack.handleError(e,t)})},p.getRecipient=function(e){var t=i.Deferred();return c.getProfile(e).done(function(e){n.spinner.hide(),p.recipient(p.chatterMapper.mapToViewModel(e)),p.recipientIsDisconnected(!1),p.errorProfile(""),t.resolve()}).fail(function(e){n.spinner.hide(),t.reject();var i=new n.system.Message(e.responseText,o.Error);n.feedBack.handleError(e,i),404===e.status&&"Request sender not found"!==e.statusText&&(p.recipientIsDisconnected(!0),p.errorProfile(e.responseText))}),t.promise()},p.getSender=function(){var e=i.Deferred();return c.getProfile(p.descriptor.chatterId).done(function(t){n.spinner.hide(),t.vip?p.getChatterPrivateMedias(t).done(function(){e.resolve()}):(p.sender(p.chatterMapper.mapToViewModel(t)),e.resolve())}).fail(function(t){n.spinner.hide(),e.reject();var i=new n.system.Message(t.responseText,o.Error);n.feedBack.handleError(t,i)}),e.promise()},p.getChatterPrivateMedias=function(e){var t=i.Deferred();return c.getChatterPrivateMedias(e.id).done(function(n){e.privateMedias=n,p.sender(p.chatterMapper.mapToViewModel(e)),t.resolve()}).fail(function(e){t.reject(e);var i=new n.system.Message(e.responseText,o.Error);n.feedBack.handleError(e,i)}),t.promise()},p.defineOldestConversationMessagesAsReadIfArent=function(e){for(var t=0;t<e.length;t++){var i=e[t];null!==i&&void 0!==i&&(i.senderId===p.sender().id||i.read||c.defineMessageAsRead(i).done(function(e){i.read=!0}).fail(function(e){var t=new n.system.Message(e.responseText,o.Error);n.feedBack.handleError(e,t)}))}},p.promptGeoloc=function(){p.event.publish("PromptGeolocation",{})},p.onGeolocationStatement=function(e,t){p.chatterIsGeolocated(t)};var h=s.subscribe("GeolocationStatement",p.onGeolocationStatement);p.onMediaSelected=function(e,t){p.mediasToSendAreVisible(!1),p.message.media(t)};var f=p.event.subscribe("MediaSelected",p.onMediaSelected);p.onMediaUnselected=function(e,t){p.message.media(void 0)};var m=p.event.subscribe("MediaUnselected",p.onMediaUnselected);p.onMainRegionChanged=function(e,t){p.chatterIsGeolocated(n.geolocation.checkGeolocation()),p.initializeWith(t)};var w=p.event.subscribe("MainRegionChanged",p.onMainRegionChanged);p.onEmoticonSelected=function(e,t){p.hideEmoticons(),p.message.text(p.message.text().concat(t.getDefaultSymbol()))};var g=p.event.subscribe("EmoticonSelected",p.onEmoticonSelected);p.recipientHasQuit=function(){p.event.publish("InterlocutorNotFound",{})},p.initializeWith=function(e){n.spinner.show(),void 0!==p.conversationUpdator&&p.conversationUpdator.stop(),i.when(p.getSender(),p.getRecipient(e)).done(function(){p.conversationUpdator=new u,p.conversationUpdator.start()})},p.refreshChattersList=function(){s.publish("RefreshChattersList",{})},p.dispose=function(){void 0!==p.conversationUpdator&&p.conversationUpdator.stop(),p.event.unsubscribe(f),p.event.unsubscribe(m),p.event.unsubscribe(g),p.event.unsubscribe(w),p.event.unsubscribe(h),d()}}}(window.system||(window.system={}),ko,window,jQuery,system.MessageType),function(e,t,n){e.AutofocusBinder=function(){var e=this;this.init=function(t){e.screenIsHighEnough()&&window.setTimeout(function(){n(t).focus()},1)},e.screenIsHighEnough=function(){return n(window).height()>500}},t.bindingHandlers.autofocus=new e.AutofocusBinder}(window.system||(window.system=system),ko,jQuery),function(e,t,n){e.Select2Binder=function(){function e(e,t){return 0==t.toUpperCase().indexOf(e.toUpperCase())}this.init=function(i,o){var s=t.unwrap(o());n.fn.select2.amd.require(["select2/compat/matcher"],function(t){null!==s.select2Max?n(i).select2({maximumSelectionLength:s.select2Max,language:{maximumSelected:function(){return s.maxErrorMessage}}}):n(i).select2({matcher:t(e)})})},this.update=function(e,i){var o=t.unwrap(i());void 0!==o.selected()&&n(e).val(o.selected()).trigger("change")}},t.bindingHandlers.select2=new e.Select2Binder}(window.system||(window.system=system),ko,jQuery),function(e,t,n){e.NstSliderBinder=function(){this.init=function(e,t){var i=t(),o=void 0!==i.mobile&&i.mobile,s=o?" ":"<br />",r=void 0!==i.singleHandle&&i.singleHandle;r?(n(e).attr("data-cur_min",i.cursorMin()).attr("data-range_min",i.min).attr("data-range_max",i.max),n(e).nstSlider({left_grip_selector:".leftGrip",value_bar_selector:".bar",value_changed_callback:function(e,t,o){i.cursorMin(t),n(this).parent().find(".leftLabel").html(t+s+i.suffix)}}),window.setTimeout(function(){n(e).nstSlider("set_position",i.cursorMin())},0)):(n(e).attr("data-cur_min",i.cursorMin()).attr("data-cur_max",i.cursorMax()).attr("data-range_min",i.min).attr("data-range_max",i.max),n(e).nstSlider({left_grip_selector:".leftGrip",right_grip_selector:".rightGrip",value_bar_selector:".bar",value_changed_callback:function(e,t,o){i.cursorMin(t),i.cursorMax(o),n(this).parent().find(".leftLabel").html(t+s+i.suffix),n(this).parent().find(".rightLabel").html(o+s+i.suffix)},user_mouseup_callback:function(e,t){e==t&&(e>i.min?(e-=1,i.cursorMin(e),n(this).parent().find(".leftLabel").html(e+s+i.suffix)):(t+=1,i.cursorMax(t),n(this).parent().find(".rightLabel").html(t+s+i.suffix)))}}))}},t.bindingHandlers.nstSlider=new e.NstSliderBinder}(window.system||(window.system=system),ko,jQuery),function(e,t,n,i,o){e.Search=function(){var e=this;this.init=function(t){n(t).keypress(function(t){13===t.keyCode&&e.performSearch()}),n(t).find("button").click(function(){e.performSearch()})},e.isMobile=function(){return n(window).width()<560},e.performSearch=function(){var t={isMobile:e.isMobile()};i.publish("SearchClicked",t)}},t.bindingHandlers.search=new e.Search}(window.system||(window.system=system),ko,jQuery,PubSub,Cookies),function(e,t,n){t.components.register("search",{viewModel:{createViewModel:function(t){var i=new e.HttpHeaderFormatter,o=new e.SearchDataService((void 0),t.descriptor,i),s=new e.CookieService(n),r=new e.SearchViewModel(t.event,s,o);return r}},template:{element:"search-template"},synchronous:!0})}(window.system||(window.system={}),ko,Cookies),function(e,t,n){t.SearchViewModel=function(t,i,o){var s=this;s.searchFormIsVisible=n.observable(!0),s.searchResultsAreVisible=n.observable(!1),s.distanceLimitMin=0,s.distanceLimitMax=500,s.selectedCountry=n.observable(""),s.selectedSubdivisions=n.observable(""),s.countries=n.observableArray([]),s.subdivisions=n.observableArray([]),s.options={genderSearched:n.observable(3),ageMin:n.observable(0),ageMax:n.observable(0),datingSearched:n.observable(0),hasProfilePicture:n.observable(!1),hasPublicMedia:n.observable(!1),keywords:n.observable(""),name:n.observable(""),country:n.observable(""),subdivisions:n.observableArray([]),distanceMin:n.observable(0),distanceMax:n.observable(500),byDistance:n.observable(!1),online:n.observable(!1)},s.chatterInfos=void 0,s.chatterIsGeolocated=n.observable(e.geolocation.checkGeolocation()),s.storedByDistance=n.observable(),s.promptGeoloc=function(){t.publish("PromptGeolocation",{})},s.options.byDistance.subscribe(function(t){s.byDistanceOptionIsDisabled()&&(e.feedBack.encourageToActivateGeolocation(s.promptGeoloc),s.options.byDistance(!1))}),s.byDistanceOptionIsDisabled=n.pureComputed(function(){return s.chatterIsGeolocated()===!1}),s.byDistance=n.pureComputed(function(){return s.options.byDistance()===!0}),s.byCountry=n.pureComputed(function(){return s.options.byDistance()===!1}),s.subdivisionIsVisible=n.pureComputed(function(){return!s.options.byDistance()&&""!==s.options.country()&&s.subdivisions().length>0}),s.isLookingForMen=n.observable(!1),s.isLookingForWomen=n.observable(!1),
s.updateGenderSearched=n.computed(function(){s.isLookingForMen()&&!s.isLookingForWomen()&&s.options.genderSearched(1),!s.isLookingForMen()&&s.isLookingForWomen()&&s.options.genderSearched(2),(s.isLookingForMen()&&s.isLookingForWomen()||!s.isLookingForMen()&&!s.isLookingForWomen())&&s.options.genderSearched(3)}),s.isLookingForFriendship=n.observable(!1),s.isLookingForFun=n.observable(!1),s.isLookingForSerious=n.observable(!1),s.updateDatingSearched=n.computed(function(){!s.isLookingForFriendship()||s.isLookingForSerious()||s.isLookingForFun()?s.isLookingForFriendship()||!s.isLookingForSerious()||s.isLookingForFun()?s.isLookingForFriendship()||s.isLookingForSerious()||!s.isLookingForFun()?s.isLookingForFriendship()&&s.isLookingForSerious()&&!s.isLookingForFun()?s.options.datingSearched(4):s.isLookingForFriendship()&&!s.isLookingForSerious()&&s.isLookingForFun()?s.options.datingSearched(5):!s.isLookingForFriendship()&&s.isLookingForSerious()&&s.isLookingForFun()?s.options.datingSearched(6):s.isLookingForFriendship()&&s.isLookingForSerious()&&s.isLookingForFun()?s.options.datingSearched(7):s.options.datingSearched(0):s.options.datingSearched(3):s.options.datingSearched(2):s.options.datingSearched(1)}),s.research=function(n){e.spinner.show("search"),t.publish("CommandSent",{}),t.publish("ResearchPerformed",s.options),n?(s.searchFormIsVisible(!1),s.searchResultsAreVisible(!0)):(s.searchFormIsVisible(!0),s.searchResultsAreVisible(!1)),s.storeOptions()},s.onSearchClicked=function(e,t){s.research(t.isMobile)};var r=t.subscribe("SearchClicked",s.onSearchClicked);s.storeOptions=function(){var e={genderSearched:s.options.genderSearched(),ageMin:s.options.ageMin(),ageMax:s.options.ageMax(),datingSearched:s.options.datingSearched(),hasProfilePicture:s.options.hasProfilePicture(),hasPublicMedia:s.options.hasPublicMedia(),keywords:s.options.keywords(),name:encodeURI(s.options.name()),country:s.options.country(),subdivisions:s.options.subdivisions(),distanceMin:s.options.distanceMin(),distanceMax:s.options.distanceMax(),byDistance:s.options.byDistance(),searchIsActive:!0,online:s.options.online()};i.setSearchOptions(e)},s.getStoredOptions=function(){return i.getSearchOptions()},s.getCountries=function(){var t=e.getFirstOrDefaultNavigatorLanguage();o.getCountries(t).done(function(e){var t=e,n={code:"",name:"-"};t.unshift(n),s.countries(t),s.selectCountry()}).fail(function(t){e.feedBack.handleError(t,null)})},s.selectCountry=function(){""!==s.selectedCountry()&&s.options.country(s.selectedCountry())},s.getSubdivisionsFrom=function(){""!==s.options.country()?o.getSubdivisionsFrom(s.options.country()).done(function(e){0==e.length?s.options.subdivisions(null):(s.subdivisions(e),s.options.subdivisions(s.selectedSubdivisions()))}).fail(function(t){e.feedBack.handleError(t,null)}):s.subdivisions([])},s.getFullSubdivisionName=function(e){return e.id.concat(" - ",e.name)},s.updateForm=function(){1===s.options.genderSearched()&&s.isLookingForMen(!0),2===s.options.genderSearched()&&s.isLookingForWomen(!0),1===s.options.datingSearched()&&s.isLookingForFriendship(!0),2===s.options.datingSearched()&&s.isLookingForSerious(!0),3===s.options.datingSearched()&&s.isLookingForFun(!0),4===s.options.datingSearched()&&(s.isLookingForFriendship(!0),s.isLookingForSerious(!0)),5===s.options.datingSearched()&&(s.isLookingForFriendship(!0),s.isLookingForFun(!0)),6===s.options.datingSearched()&&(s.isLookingForSerious(!0),s.isLookingForFun(!0)),7===s.options.datingSearched()&&(s.isLookingForFriendship(!0),s.isLookingForSerious(!0),s.isLookingForFun(!0))},s.getChatterInfos=function(){return i.getChatterInfos()},s.initializeOptions=function(){s.chatterInfos=s.getChatterInfos(),s.ageLimitMin=s.chatterInfos.isMajor?18:13,s.ageLimitMax=s.chatterInfos.isMajor?99:17;var t,n,i=s.getStoredOptions();void 0!==i&&null!==i?(s.chatterInfos.isMajor?(t=i.ageMin>=18?i.ageMin:s.ageLimitMin,n=i.ageMax>17?i.ageMax:s.ageLimitMax):(t=i.ageMin<18?i.ageMin:s.ageLimitMin,n=i.ageMax<=17?i.ageMax:s.ageLimitMax),s.options.genderSearched(i.genderSearched),s.options.ageMin(t),s.options.ageMax(n),s.options.datingSearched(i.datingSearched),s.options.hasProfilePicture(i.hasProfilePicture),s.options.hasPublicMedia(i.hasPublicMedia),s.options.keywords(""),s.options.name(decodeURI(i.name)),s.options.distanceMin(i.distanceMin),s.options.distanceMax(i.distanceMax),s.storedByDistance(i.byDistance),s.options.online(i.online),e.setTimeout(s.setByDistanceOption,500),s.selectedCountry(i.country),s.selectedSubdivisions(i.subdivisions),s.updateForm()):(t=s.chatterInfos.isMajor?18:13,n=s.chatterInfos.isMajor?99:17,s.options.ageMin(t),s.options.ageMax(n))},s.setByDistanceOption=function(){s.options.byDistance(!!s.chatterIsGeolocated()&&s.storedByDistance())},s.onGeolocationStatement=function(e,t){s.chatterIsGeolocated(t)};var a=t.subscribe("GeolocationStatement",s.onGeolocationStatement);s.onMainRegionChanged=function(t,n){s.chatterIsGeolocated(e.geolocation.checkGeolocation())};var c=t.subscribe("MainRegionChanged",s.onMainRegionChanged);s.getCountries(),s.initializeOptions(),s.dispose=function(){t.unsubscribe(r),t.unsubscribe(a),t.unsubscribe(c)}}}(window,window.system||(window.system={}),ko),function(e,t,n,i,o,s,r){var a=new e.CookieService(i),c=a.getUserDescriptor(),d=new e.ChatViewModel(o,c,c.applicationId,a);r(function(){n.applyBindings(d),d.initialize();var e=s.initializeRoutes();o.subscribe("ProfileClicked",function(t,n){e.setRoute("/profile/".concat(encodeURI(n)))}),o.subscribe("InterlocutorAdded",function(t,n){e.setRoute("/conversation/".concat(encodeURI(n)))}),o.subscribe("NoMoreInterlocutors",function(t,n){e.setRoute("/newinterlocutors")}),o.subscribe("InterlocutorNotFound",function(t,n){e.setRoute("/newinterlocutors")}),o.subscribe("ConversationClicked",function(t,n){e.setRoute("/conversation/".concat(encodeURI(n)))}),o.subscribe("NewMessagesClicked",function(t,n){e.setRoute("/newinterlocutors")}),t.feedBack.activationNotification(),t.feedBack.welcomeUser(),o.publish("PromptGeolocation",{});var i=n.observable(!1);o.subscribe("VisibleIfMobile",function(n,o){i(o.isVisible),"/Chat"!==t.location.pathname&&"/Chat/Index"!==t.location.pathname||""!==t.location.hash&&"#/home"!==t.location.hash||(i()?e.setRoute("/home"):e.setRoute("/search"))}),r.ajaxSetup({error:function(e,n,i){498!=e.status&&4011!=e.status||(Cookies.remove("chat",{path:"/"}),t.location.href="/")}}),t.analytics.trackPageView("Home/Index","Chat/Index")})}(window.system||(window.system={}),window,ko,Cookies,PubSub,Router,jQuery),function(e,t){e.HomeDataService=function(n,i,o,s){var r=this;r.base=e.ChatDataService,r.base(n,i,o),r.getChatter=function(e){return r.get("chatters/".concat(encodeURI(e)),{})},r.getNumberOfOnlineChatters=function(){var e=t.Deferred();return t.ajax({headers:{"Tenant-Id":s},accepts:{json:"application/json"},type:"HEAD",url:r.baseUrl.concat("chat?withrecentlyoffline=true"),data:{}}).done(function(t,n,i){e.resolve(i.getResponseHeader("Count"))}).fail(function(t){e.reject(t)}),e.promise()}},e.HomeDataService.prototype=new e.ChatDataService}(window.system||(window.system={}),jQuery),function(e,t){e.FlashMessagingDataService=function(n,i,o){var s=this;s.base=e.ChatDataService,s.base(n,i,o),s.sendMessage=function(e,t){return s.post("messages",{senderId:i.chatterId,recipientId:e,text:t})},s.getLastMessageSentTo=function(e){var n=t.Deferred();return s.get("messages?interlocutorid2=".concat(encodeURI(e),"&interlocutorid1=",encodeURI(i.chatterId)),{}).done(function(e){for(var t="",o=e.length-1;o>=0&&(t=e[o],t.senderId!==i.chatterId);o--);n.resolve(t)}).fail(function(e){n.reject(e)}),n.promise()}}}(window.system||(window.system={}),jQuery),function(e,t){e.RatingDataService=function(t,n,i){var o=this;o.base=e.ChatDataService,o.base(t,n,i),o.rateVip=function(e,t){return o.post("vips/".concat(encodeURI(e),"/rating"),{value:t})}},e.RatingDataService.prototype=new e.ChatDataService}(window.system||(window.system={}),jQuery),function(e,t){e.ContactDataService=function(t,n,i){var o=this;o.base=e.ChatDataService,o.base(t,n,i),o.addToFavorites=function(e){return o.post("vips/".concat(encodeURI(n.chatterId),"/favorites"),{chatterId:e})},o.addToBlacklist=function(e){return o.post("vips/".concat(encodeURI(n.chatterId),"/blacklist"),{chatterId:e})},o.deleteFromFavorites=function(e){return o["delete"]("vips/".concat(encodeURI(n.chatterId),"/favorites/",encodeURI(e)))},o.deleteFromBlacklist=function(e){return o["delete"]("vips/".concat(encodeURI(n.chatterId),"/blacklist/",encodeURI(e)))},o.reportAbuseOnProfile=function(e){return o.post("profilereport",{chatterId:e})}},e.ContactDataService.prototype=new e.ChatDataService}(window.system||(window.system={}),jQuery),function(e,t){e.MediaDataService=function(n,i,o){var s=this;s.base=e.ChatDataService,s.base(n,i,o),s.uploadPrivateMedia=function(e){var n=new FormData;return n.append("file",e),n.append("private",!0),t.ajax({headers:{"User-Descriptor":o.format(i)},accepts:{json:"application/json"},url:s.baseUrl.concat("vips/".concat(encodeURI(i.chatterId),"/medias")),data:n,contentType:!1,processData:!1,type:"POST"})},s.uploadPublicMedia=function(e){var n=new FormData;return n.append("file",e),n.append("private",!1),t.ajax({headers:{"User-Descriptor":o.format(i)},accepts:{json:"application/json"},url:s.baseUrl.concat("vips/".concat(encodeURI(i.chatterId),"/medias")),data:n,contentType:!1,processData:!1,type:"POST"})},s.deleteMedia=function(e){return s["delete"]("vips/".concat(encodeURI(i.chatterId),"/medias/",e))},s.defineAsProfilePicture=function(e){return s.put("vips/".concat(encodeURI(i.chatterId),"/profilepicture"),{mediaId:e.id})},s.switchStatusMedia=function(e){return s.patch("vips/".concat(encodeURI(i.chatterId),"/medias/",e.id),{"private":!e["private"]})},s.reportAbuseOnMedia=function(e){return s.post("mediareport/",{mediaId:e.id})}},e.MediaDataService.prototype=new e.ChatDataService}(window.system||(window.system={}),jQuery),function(e,t){e.ProfileDataService=function(t,n,i){var o=this;o.base=e.ChatDataService,o.base(t,n,i),o.getProfile=function(e){return o.get("chatters/".concat(encodeURI(e)),{})},o.reportAbuseOnProfile=function(e){return o.post("profilereport",{chatterId:e})}},e.ProfileDataService.prototype=new e.ChatDataService}(window.system||(window.system={}),jQuery),function(e,t){e.ConversationDataService=function(t,n,i){var o=this;o.base=e.ChatDataService,o.base(t,n,i),o.sendMessage=function(e,t){var i=t.text;return null==/</.exec(i)&&null==/>/.exec(i)||(i="..."),o.post("messages",{senderId:n.chatterId,recipientId:e,text:i,media:t.media})},o.getProfile=function(e){return o.get("chatters/".concat(encodeURI(e)),{})},o.getConversation=function(e,t){return o.get("messages?interlocutorid2=".concat(encodeURI(e),"&interlocutorid1=",encodeURI(t)),{})},o.getInterlocutors=function(e,t){return window.location.href.indexOf("club")==-1?o.get("chatters/".concat(encodeURI(n.chatterId),"/interlocutors?offset=",e,"&limit=",t,"&incomingnewmessages=true"),{}):o.get("chatters/".concat(encodeURI(n.chatterId),"/interlocutors?offset=",e,"&limit=",t,"&incomingnewmessages=true&interlocutorOnlyOnline=true"),{})},o.deleteInterlocutor=function(e){return o["delete"]("chatters/".concat(encodeURI(n.chatterId),"/interlocutors/",encodeURI(e)))},o.sendMessageReport=function(e,t){return o.post("messagereport",{messageId:e,reason:t})},o.defineMessageAsRead=function(e){return o.patch("messages/".concat(e.id),{read:!0})},o.getChatterPrivateMedias=function(e){return o.get("vips/".concat(encodeURI(e),"/medias","?mediastatus=",1))}},e.ConversationDataService.prototype=new e.ChatDataService}(window.system||(window.system={}),jQuery),function(e,t){e.SearchDataService=function(t,n,i){var o=this;o.base=e.ChatDataService,o.base(t,n,i),o.getSubdivisionsFrom=function(e){return o.get("subdivisions?countrycode=".concat(e))},o.getCountries=function(e){return o.get("countries?language=".concat(e))}},e.SearchDataService.prototype=new e.ChatDataService}(window.system||(window.system={}),jQuery),function(e,t){e.ConversationChatterMapper=function(){var e=this;this.mapToViewModel=function(n){return n.isGeolocalized=n.longitude!==-1&&n.latitude!==-1,n.isAMan=0===n.gender,n.isAWoman=1===n.gender,n.hasPublicMedias=n.publicMedias.length>0,n.hasPrivateMedias=void 0!==n.privateMedias&&n.privateMedias.length>0,n.hasMedias=n.hasPublicMedias||n.hasPrivateMedias,n.blacklisted=t.observable(n.blacklisted),n.favorite=t.observable(n.favorite),n.medias=e.mapChatterMedias(n),n.hasNoMedia=!n.hasPublicMedias&&!n.hasPrivateMedias,n.isAd=2===n.type,n},this.mapChatterMedias=function(e){return e.hasPublicMedias&&e.hasPrivateMedias?e.publicMedias.concat(e.privateMedias):e.hasPublicMedias&&!e.hasPrivateMedias?e.publicMedias:!e.hasPublicMedias&&e.hasPrivateMedias?e.privateMedias:void 0}}}(window.system||(window.system={}),ko),function(e,t,n,i){t.ProfileChatterMapper=function(){var t=this;this.mapToViewModel=function(e){return e.masterProfilePicture=t.getMasterMedia(e.profilePictureUrl),e.blacklisted=n.observable(e.blacklisted),e.favorite=n.observable(e.favorite),e.lastVisit=t.getLocaleDate(e.lastVisit),e.rate=n.observable(e.rating),e.isAMan=0===e.gender,e.isAWoman=1===e.gender,e.hasNotGenderSearched=0===e.genderSearched,e.isLookingForMan=1===e.genderSearched,e.isLookingForWoman=2===e.genderSearched,e.isLookingForBoth=3===e.genderSearched,e.hasNotDatingSearch=0===e.datingSearched,e.isLookingForFriendship=1===e.datingSearched,e.isLookingForSerious=2===e.datingSearched,e.isLookingForFun=3===e.datingSearched,e.isLookingForFriendshipAndSerious=4===e.datingSearched,e.isLookingForFriendshipAndFun=5===e.datingSearched,e.isLookingForFunAndSerious=6===e.datingSearched,e.isLookingForAllDatingSearch=7===e.datingSearched,e.hasHeight=e.height!==-1,e.hasWeight=e.weight!==-1,e.hasNoWeightNorHeight=!e.hasHeight&&!e.hasWeight,e.hasInterests=t.hasInterests(e),e.hasNoInterests=!e.hasInterests,e.isGeolocalized=e.longitude!==-1&&e.latitude!==-1,e.isNotGeolocalized=!e.isGeolocalized,e.hasPublicMedias=e.publicMedias.length>0,e.hasADescription=""!==e.description.trim(),e.hasNotADescription=!e.hasADescription,e.interests=t.getInterests(e),e.publicMedias=t.setVideosSources(e.publicMedias),e},this.hasInterests=function(e){var t=n.utils.arrayFilter(e.interests,function(e){return e.interested});return t.length>0},this.getInterests=function(e){var t=n.utils.arrayFilter(e.interests,function(e){return e.interested});return t},t.getMasterMedia=function(e){return e.replace("&w=100&h=100&maxSize=3000","")},t.setVideosSources=function(e){for(var t=0;t<e.length;t++)1===e[t].type&&(e[t].url=e[t].url.replace("&w=300&h=300&maxSize=15000",""),e[t].urlMP4=e[t].url+"&f=mp4&ext=.mp4");return e},this.getLocaleDate=function(t){return i(t).locale(e.getFirstOrDefaultNavigatorLanguage()).format("l")}}}(window,window.system||(window.system={}),ko,moment),function(e,t){e.SnsButtonsParse=function(){this.init=function(e){window.setTimeout(function(){try{FB.XFBML.parse(),gapi.plusone.go(),twttr.widgets.load()}catch(e){}},1e3)}},t.bindingHandlers.snsButtonsParse=new e.SnsButtonsParse}(window.system||(window.system=system),ko);var userDescriptor,chatterId;!function(e,t,n,i,o){o(function(){var t=new e.CookieService(i),n=(e.ChatDataService,t.getChatterInfos(),t.getSecurityCookie()),o=JSON.parse(n).isVip;new e.HttpHeaderFormatter;userDescriptor=JSON.parse(t.getSecurityCookie()).userDescriptor,chatterId=userDescriptor.chatterId,o&&setTimeout(CheckActivation,12e4)})}(window.system||(window.system={}),window,ko,Cookies,jQuery);*/