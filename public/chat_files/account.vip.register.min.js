"use strict";!function(e,t,r,n,o){e.RegisterForm=function(){var r=this;r.cookieService=new e.CookieService(o),r.today=t(),r.defaultYear=r.today.year()-18,r.formIsDirty=!1,r.getGuestLoginInfos=function(){return r.cookieService.getGuestLoginInfos()},r.formInputs={day:{input:n("#Day"),pattern:null},month:{input:n("#Month"),pattern:null},year:{input:n("#Year"),pattern:null},email:{input:n("#Email"),pattern:/^(?!.{101})[^\W][a-zA-Z0-9_.-]+(\.[a-zA-Z0-9_]+)*\@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_]+)*\.[a-zA-Z]{2,4}$/},phoneNumber:{input:n("#PhoneNumber"),pattern:null},name:{input:n("#Name"),pattern:/^([a-zA-Z0-9]){3,15}$/},password:{input:n("#Password"),pattern:/^\w{6,25}$/},termsCgu:{input:n("#termsCgu"),pattern:null},termsPrivacy:{input:n("#termsPrivacy"),pattern:null}},r.formDefaultValues={gender:0,genderSearched:0,day:r.today.date(),month:r.today.month()+1,year:r.defaultYear,email:"",phoneNumber:"",name:"",password:"",termsCgu:!1,termsPrivacy:!1},r.birthdateIsInvalid=function(){r.fixYear();var e=t({year:r.formInputs.year.input.val(),month:r.formInputs.month.input.val()-1,day:r.formInputs.day.input.val()});return!(e.isValid()&&r.hasOverThirteenYears(e)&&r.hasLessThanNinetyNineYears(e))},r.fixYear=function(){if(2===r.formInputs.year.input.val().length){var e=parseInt(r.formInputs.year.input.val());e<10?r.formInputs.year.input.val("20"+r.formInputs.year.input.val()):r.formInputs.year.input.val("19"+r.formInputs.year.input.val())}},r.hasLessThanNinetyNineYears=function(e){return r.today.diff(e,"years",!0)<=99},r.hasOverThirteenYears=function(e){return r.today.diff(e,"years",!0)>=13},r.getFBLoginInfos=function(){return r.cookieService.getFBLoginInfos()},r.getGoogleLoginInfos=function(){return r.cookieService.getGoogleLoginInfos()},r.initializeForm=function(){var e=r.getGuestLoginInfos();void 0!==e&&null!==e?(setInputValue(r.formInputs.day.input,e.day),r.setInputValue(r.formInputs.month.input,e.month),r.setInputValue(r.formInputs.year.input,e.year)):(null),r.setInputValue(r.formInputs.day.input,r.formDefaultValues.day),r.setInputValue(r.formInputs.month.input,r.formDefaultValues.month),r.setInputValue(r.formInputs.year.input,r.formDefaultValues.year),r.setInputValue(r.formInputs.email.input,r.formDefaultValues.email),r.setInputValue(r.formInputs.phoneNumber.input,r.formDefaultValues.phoneNumber),r.setInputValue(r.formInputs.name.input,r.formDefaultValues.name),r.setInputValue(r.formInputs.password.input,r.formDefaultValues.password),n('select[data-type="genderSearched"]').length>0&&(n(".genderSearched_chbx > input:checked").length>0?n('select[data-type="genderSearched"]').val(n(".genderSearched_chbx > input:checked").val()):n('select[data-type="genderSearched"]').val("-1")));var o=r.getFBLoginInfos();if(void 0!==o&&null!==o){var s=0;s="male"==o.gender?0:1,r.setGenderValue(s),0==s?n("#FemaleSearched").prop("checked",!0):n("#MaleSearched").prop("checked",!0);var a=t(o.birthday,"MM-DD-YYYY").get("date"),i=t(o.birthday,"MM-DD-YYYY").get("month"),u=t(o.birthday,"MM-DD-YYYY").get("year");r.formInputs.day.input.val(a),r.formInputs.month.input.val(i+1),r.formInputs.year.input.val(u),r.setInputValue(r.formInputs.email.input,o.email),r.setInputValue(r.formInputs.name.input,o.name.replace(/\s+/g,""))}var d=r.getGoogleLoginInfos();void 0!==d&&null!==d&&(r.setGenderValue(0),n("#FemaleSearched").prop("checked",!0),r.setInputValue(r.formInputs.email.input,d.email),r.setInputValue(r.formInputs.name.input,d.name.replace(/\s+/g,"")))},r.setGenderValue=function(e){""===e&&(e="0");var t=""!==n("#modelGender").val()?n("#modelGender").val():e;0===n("#GenderMale").length&&0===n("#GenderFemale").length?n("#Gender").val(e):(n("#GenderMale").prop("checked","0"===t||0===t),n("#GenderFemale").prop("checked","1"===t||1===t))},r.setInputValue=function(e,t){""!==e.val()&&"0"!==e.val()||e.val(t)},r.handleErrorMessages=function(e){n(e).each(function(){n(this).focus(function(){n(this).removeClass("error"),n(this).next(".error-message").removeClass("shown"),"PhoneNumber"==n(this).attr("id")&&n("#PhoneNumber-ErrorMessage").removeClass("shown"),n(this).hasClass("birthdate-field")&&(n(".error-message.birthdate-field").removeClass("shown"),r.formInputs.day.input.removeClass("error"),r.formInputs.month.input.removeClass("error"),r.formInputs.year.input.removeClass("error"))}),n(this).blur(function(){n(this).hasClass("birthdate-field")&&(""===r.formInputs.day.input.val()||""===r.formInputs.month.input.val()||""===r.formInputs.year.input.val()||r.birthdateIsInvalid()?(n(".error-message.birthdate-field").addClass("shown"),r.formInputs.day.input.addClass("error"),r.formInputs.month.input.addClass("error"),r.formInputs.year.input.addClass("error")):(n(".error-message.birthdate-field").removeClass("shown"),r.formInputs.day.input.removeClass("error"),r.formInputs.month.input.removeClass("error"),r.formInputs.year.input.removeClass("error"))),"PhoneNumber"==n(this).attr("id")&&(n(this).val(n(this).val().replace(/\s/g,"")),n(this).val(n(this).val().replace(/\(/g,"")),n(this).val(n(this).val().replace(/\)/g,"")),n(this).val(n(this).val().replace(/\;/g,"")),n(this).val(n(this).val().replace(/\,/g,"")),n(this).val(n(this).val().replace(/\-/g,"")),n(this).val(n(this).val().replace(/\N/g,"")),n(this).val(n(this).val().replace(/\//g,"")),n(this).val(n(this).val().replace(/\./g,"")),n(this).val(n(this).val().replace(/\#/g,"")),n(this).val(n(this).val().replace(/\*/g,"")),n(this).intlTelInput("isValidNumber")?(n(this).removeClass("error"),n("#PhoneNumber-ErrorMessage").removeClass("shown")):(n(this).addClass("error"),n("#PhoneNumber-ErrorMessage").addClass("shown")));var e=r.formInputs[n(this).attr("data-type")].pattern;(""===n(this).val()||e&&!e.test(n(this).val()))&&(n(this).addClass("error"),n(this).next(".error-message").addClass("shown"),0===n(this).next(".error-message").length&&n(this).parent().next(".error-message").addClass("shown"))}),n('input[data-type="genderSearched"]').change(function(){n("#MaleSearched").prop("checked")||n("#FemaleSearched").prop("checked")?(n(".error-message.genderSearched").removeClass("shown"),n(".gender-wrapper").removeClass("error")):(n(".error-message.genderSearched").addClass("shown"),n(".gender-wrapper").addClass("error"))}),n('select[data-type="genderSearched"]').change(function(){"-1"===n(this).val()?n(".error-message.genderSearched").addClass("shown"):(n(".error-message.genderSearched").removeClass("shown"),n(".genderSearched_chbx > input").prop("checked",!1),n(".genderSearched_chbx").find('input[value="'+n(this).val()+'"]').prop("checked",!0))}),n("input#termsCgu").change(function(){n(this).prop("checked")?(n(".error-message.termsCgu").removeClass("shown"),n(".termsCgu").removeClass("error")):(n(".error-message.termsCgu").addClass("shown"),n(".termsCgu").addClass("error"))}),n("input#termsPrivacy").change(function(){n(this).prop("checked")?(n(".error-message.termsPrivacy").removeClass("shown"),n(".termsPrivacy").removeClass("error")):(n(".error-message.termsPrivacy").addClass("shown"),n(".termsPrivacy").addClass("error"))})})},r.onSubmitForm=function(e,t){var o=!1;return n(t).each(function(){n(this).hasClass("birthdate-field")&&(""===r.formInputs.day.input.val()||""===r.formInputs.month.input.val()||""===r.formInputs.year.input.val()||r.birthdateIsInvalid())&&(n(".error-message.birthdate-field").addClass("shown"),r.formInputs.day.input.addClass("error"),r.formInputs.month.input.addClass("error"),r.formInputs.year.input.addClass("error"),o=!0),"PhoneNumber"==n(this).attr("id")&&(n(this).intlTelInput("isValidNumber")||(n(this).addClass("error"),n("#PhoneNumber-ErrorMessage").addClass("shown"),o=!0));var e=r.formInputs[n(this).attr("data-type")].pattern;(""===n(this).val()||e&&!e.test(n(this).val()))&&(n(this).addClass("error"),n(this).next(".error-message").addClass("shown"),o=!0)}),n("#MaleSearched").prop("checked")||n("#FemaleSearched").prop("checked")||(n(".error-message.genderSearched").addClass("shown"),n(".gender-wrapper").addClass("error"),o=!0),n("input#termsCgu").prop("checked")||(n(".error-message.terms").addClass("shown"),n(".termsCgu").addClass("error"),o=!0),n("input#termsPrivacy").prop("checked")||(n(".error-message.terms").addClass("shown"),n(".termsPrivacy").addClass("error"),o=!0),r.formIsDirty=o,r.formIsDirty?(e.preventDefault(),void(n("body").hasClass("mobile")&&n(".content").animate({scrollTop:n(".error-message.shown").offset().top-n(".content").offset().top+n(".content").scrollTop()},200))):void window.spinner.show()},this.init=function(e){r.initializeForm();var t=n(e).find(".validate");r.handleErrorMessages(t),n("#PhoneNumber").length&&(n("#PhoneNumber").intlTelInput({nationalMode:!1,initialCountry:"auto",geoIpLookup:function(e){n.get("https://ipinfo.io",function(){},"jsonp").always(function(t){var r=t&&t.country?t.country:"";e(r)})},preferredCountries:[],autoPlaceholder:!1,utilsScript:"/chat_files/telutils.min.js"}),n("#PhoneNumber").keydown(function(e){var t=e.charCode||e.keyCode||0;return 8==t||9==t||13==t||46==t||t>=35&&t<=40||t>=48&&t<=57||t>=96&&t<=105})),n(e).submit(function(e){r.onSubmitForm(e,t)})}},r.bindingHandlers.registerForm=new e.RegisterForm}(window.system||(window.system=system),moment,ko,jQuery,Cookies),function(e,t){e.RegisterViewModel=function(e,r,n){var o=this;o.event=e,o.selectedCountry=t.observable(""),o.selectedSubdivision=t.observable(""),o.country=t.observable(""),o.subdivision=t.observable(""),o.countries=t.observableArray([]),o.subdivisions=t.observableArray([]),o.latitude=t.observable(-1),o.longitude=t.observable(-1),o.geolocation=t.observable(),o.subdivisionIsVisible=t.pureComputed(function(){return""!==o.country()&&void 0!==o.country()&&o.subdivisions().length>0}),o.getCountries=function(){var e=window.getFirstOrDefaultNavigatorLanguage();n.getCountries(e).done(function(e){var t=e,r={code:"",name:"-"};t.unshift(r),o.countries(t),o.selectCountry()}).fail(function(e){window.feedBack.handleError(e,null)})},o.selectCountry=function(){""!==o.selectedCountry()&&(o.country(o.selectedCountry()),o.getSubdivisionsFrom())},o.getSubdivisionsFrom=function(){""!==o.country()&&void 0!==o.country()?n.getSubdivisionsFrom(o.country()).done(function(e){o.subdivisions(e),o.selectSubdivision()}).fail(function(e){window.feedBack.handleError(e,null)}):o.subdivisions([])},o.selectSubdivision=function(){""!==o.selectedSubdivision()&&(o.subdivision(o.selectedSubdivision()),o.updateGeolocationInformations(o.subdivision()))},o.getFullSubdivisionName=function(e){return e.id.concat(" - ",e.name)},o.updateLocalizationFields=function(e){o.selectedCountry(e.countryCode),o.selectCountry();var t=e.subdivisionId;"undefined"!==o.geolocation().subdivision&&o.geolocation().subdivision!==e.subdivisionId&&(t=o.geolocation().subdivision),o.selectedSubdivision(e.subdivisionId),o.selectSubdivision(),o.updateGeolocationInformations(t)},o.updateGeolocationInformations=function(e){o.event.publish("SubdivisionUpdate",e)},o.getCountryAndSubdivisionFromCoordinates=function(){o.latitude()===-1||o.longitude()===-1?n.getCountryAndSubdivisionFromIPAddress().done(function(e){window.spinner.hide(),o.updateLocalizationFields(e)}).fail(function(e){window.spinner.hide(),window.feedBack.handleError(e,null)}):n.getCountryAndSubdivisionFromCoordinates(o.latitude(),o.longitude()).done(function(e){window.spinner.hide(),o.updateLocalizationFields(e)}).fail(function(e){window.spinner.hide(),window.feedBack.handleError(e,null)})},o.getGeolocationInformations=function(){o.geolocation(r.getGeolocationInformations())},o.onGettingCoordinates=function(e,t){o.latitude(t.latitude),o.longitude(t.longitude),o.getCountryAndSubdivisionFromCoordinates()};var s=o.event.subscribe("ChatterCoordinates",o.onGettingCoordinates);o.initializeForm=function(){o.getCountries(),""!==o.selectedCountry()&&null!==o.selectedCountry()||o.getCountryAndSubdivisionFromCoordinates()},o.initializeForm(),o.getGeolocationInformations(),o.dispose=function(){o.event.unsubscribe(s)}}}(window.system||(window.system={}),ko),function(e,t){e.RegisterDataService=function(t,r,n){var o=this;o.base=e.ChatDataService,o.base(t,r,n),o.getSubdivisionsFrom=function(e){return o.get("subdivisions?countrycode=".concat(e))},o.getCountries=function(e){return o.get("countries?language=".concat(e))},o.getCountryAndSubdivisionFromCoordinates=function(e,t){return o.get("localization",{latitude:e,longitude:t})},o.getCountryAndSubdivisionFromIPAddress=function(){return o.get("localization")}},e.RegisterDataService.prototype=new e.ChatDataService}(window.system||(window.system={}),jQuery),function(e,t,r,n,o){var s=new e.CookieService(r),a=new e.HttpHeaderFormatter,i=new e.RegisterDataService((void 0),{chatterId:void 0,applicationId:void 0},a),u=new e.RegisterViewModel(n,s,i);$(function(){if(t.applyBindings(u),n.publish("PromptGeolocation",{}),window.analytics.trackPageView("Register","Account/Register"),""!==$("#htmlValidation").html()&&void 0!==$("#htmlValidation").html()){var e=new window.system.Message($("#htmlValidation").html(),o.Error);window.feedBack.handleError({},e)}})}(window.system||(window.system={}),ko,Cookies,PubSub,system.MessageType);